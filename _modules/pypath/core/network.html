
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pypath.core.network &#8212; pypath 0.15.8 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/pypathdocs.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pypath/core/network';</script>
    <link rel="icon" href="../../../_static/omnipath-logo.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../contents.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/omnipath-logo.svg" class="logo__image only-light" alt="Pypath"/>
    <script>document.write(`<img src="../../../_static/omnipath-logo.svg" class="logo__image only-dark" alt="Pypath"/>`);</script>
  
  
    <p class="title logo__title">Pypath</p>
  
</a></div>
    
  </div>
  
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../index.html">
                        Welcome to pypath!
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../webservice.html">
                        Webservice
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../releasehistory.html">
                        Release history
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference.html">
                        Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../notebooks/manual.html">
                        The pypath book
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/saezlab/pypath" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/omnipathdb" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/pypath-omnipath" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-box"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://omnipathdb.org/" title="OmniPath" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-university"></i></span>
            <label class="sr-only">OmniPath</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://saezlab.org/" title="Saez Lab" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-users"></i></span>
            <label class="sr-only">Saez Lab</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../index.html">
                        Welcome to pypath!
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../webservice.html">
                        Webservice
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../releasehistory.html">
                        Release history
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference.html">
                        Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../notebooks/manual.html">
                        The pypath book
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/saezlab/pypath" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/omnipathdb" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/pypath-omnipath" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-box"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://omnipathdb.org/" title="OmniPath" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-university"></i></span>
            <label class="sr-only">OmniPath</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://saezlab.org/" title="Saez Lab" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-users"></i></span>
            <label class="sr-only">Saez Lab</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../contents.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    
    <li class="breadcrumb-item"><a href="../../pypath.html" class="nav-link">pypath</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">pypath.core.network</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for pypath.core.network</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#</span>
<span class="c1">#  This file is part of the `pypath` python module</span>
<span class="c1">#</span>
<span class="c1">#  Copyright 2014-2023</span>
<span class="c1">#  EMBL, EMBL-EBI, Uniklinik RWTH Aachen, Heidelberg University</span>
<span class="c1">#</span>
<span class="c1">#  Authors: see the file `README.rst`</span>
<span class="c1">#  Contact: Dénes Türei (turei.denes@gmail.com)</span>
<span class="c1">#</span>
<span class="c1">#  Distributed under the GPLv3 License.</span>
<span class="c1">#  See accompanying file LICENSE.txt or copy at</span>
<span class="c1">#      https://www.gnu.org/licenses/gpl-3.0.html</span>
<span class="c1">#</span>
<span class="c1">#  Website: https://pypath.omnipathdb.org/</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">future.utils</span> <span class="kn">import</span> <span class="n">iteritems</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Mapping</span>

<span class="kn">import</span> <span class="nn">importlib</span> <span class="k">as</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">copy_mod</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">pypath.share.session</span> <span class="k">as</span> <span class="nn">session_mod</span>
<span class="kn">import</span> <span class="nn">pypath.share.progress</span> <span class="k">as</span> <span class="nn">progress</span>
<span class="kn">import</span> <span class="nn">pypath.core.interaction</span> <span class="k">as</span> <span class="nn">interaction_mod</span>
<span class="kn">import</span> <span class="nn">pypath.core.evidence</span> <span class="k">as</span> <span class="nn">evidence</span>
<span class="kn">import</span> <span class="nn">pypath.core.entity</span> <span class="k">as</span> <span class="nn">entity_mod</span>
<span class="kn">import</span> <span class="nn">pypath.core.common</span> <span class="k">as</span> <span class="nn">core_common</span>
<span class="kn">import</span> <span class="nn">pypath.share.common</span> <span class="k">as</span> <span class="nn">common</span>
<span class="kn">import</span> <span class="nn">pypath.share.settings</span> <span class="k">as</span> <span class="nn">settings</span>
<span class="kn">import</span> <span class="nn">pypath.share.cache</span> <span class="k">as</span> <span class="nn">cache_mod</span>
<span class="kn">import</span> <span class="nn">pypath.share.constants</span> <span class="k">as</span> <span class="nn">constants</span>
<span class="kn">import</span> <span class="nn">pypath.utils.mapping</span> <span class="k">as</span> <span class="nn">mapping</span>
<span class="kn">import</span> <span class="nn">pypath.inputs.pubmed</span> <span class="k">as</span> <span class="nn">pubmed_input</span>
<span class="kn">import</span> <span class="nn">pypath.share.curl</span> <span class="k">as</span> <span class="nn">curl</span>
<span class="kn">import</span> <span class="nn">pypath.internals.refs</span> <span class="k">as</span> <span class="nn">refs_mod</span>
<span class="kn">import</span> <span class="nn">pypath.internals.resource</span> <span class="k">as</span> <span class="nn">resource_mod</span>
<span class="kn">import</span> <span class="nn">pypath.utils.reflists</span> <span class="k">as</span> <span class="nn">reflists</span>
<span class="kn">import</span> <span class="nn">pypath.resources.network</span> <span class="k">as</span> <span class="nn">network_resources</span>
<span class="kn">import</span> <span class="nn">pypath.inputs</span> <span class="k">as</span> <span class="nn">inputs</span>

<span class="c1"># Py 2/3</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">raw_input</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">NetworkEntityCollection</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;NetworkEntityCollection&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s1">&#39;total&#39;</span><span class="p">,</span>
        <span class="s1">&#39;by_resource&#39;</span><span class="p">,</span>
        <span class="s1">&#39;by_category&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared_res_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_res_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;resource_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cat_resource&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method&#39;</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">NetworkEntityCollection</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">8</span>


<div class="viewcode-block" id="NetworkEntityCollection"><a class="viewcode-back" href="../../../api/pypath.core.network.NetworkEntityCollection.html#pypath.core.network.NetworkEntityCollection">[docs]</a><span class="k">class</span> <span class="nc">NetworkEntityCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;collection&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_collection&#39;</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">,</span>

        <span class="s1">&#39;shared_within_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_within_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared_within_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_within_interaction_type&#39;</span><span class="p">,</span>

        <span class="s1">&#39;n_collection&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_shared_within_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_unique_within_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_shared_within_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_unique_within_interaction_type&#39;</span><span class="p">,</span>

        <span class="s1">&#39;pct_collection&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_within_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_within_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_shared_within_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_unique_within_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_shared_within_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_unique_within_interaction_type&#39;</span><span class="p">,</span>

        <span class="s1">&#39;by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;by_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_by_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared_by_interaction_type&#39;</span><span class="p">,</span>

        <span class="s1">&#39;n_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_by_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_unique_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_shared_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_unique_by_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_shared_by_interaction_type&#39;</span><span class="p">,</span>

        <span class="s1">&#39;pct_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_by_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_unique_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_shared_by_data_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_unique_by_interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pct_shared_by_interaction_type&#39;</span><span class="p">,</span>

    <span class="p">]</span>


<div class="viewcode-block" id="NetworkEntityCollection.__init__"><a class="viewcode-back" href="../../../api/pypath.core.network.NetworkEntityCollection.html#pypath.core.network.NetworkEntityCollection.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># we need a copy where we don&#39;t add the totals</span>
        <span class="c1"># so these don&#39;t bother the shared and unique methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_add_total</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_collection_counts</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">update_collection_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_collection</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">dict_counts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pct_collection</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">dict_set_percent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">collection_add_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_total</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;Total&#39;</span><span class="p">)</span>
        <span class="p">)</span>


    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;interaction_type&#39;</span><span class="p">,</span> <span class="s1">&#39;data_model&#39;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">,</span> <span class="n">summarize_groups</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">summarize_groups</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="n">midpart</span> <span class="o">=</span> <span class="s1">&#39;_by_&#39;</span> <span class="k">if</span> <span class="n">summarize_groups</span> <span class="k">else</span> <span class="s1">&#39;_within_&#39;</span>

        <span class="k">if</span> <span class="n">summarize_groups</span><span class="p">:</span>

            <span class="n">collection</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">dict_subtotals</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_keys</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">by</span> <span class="o">=</span> <span class="s1">&#39;by_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">level</span>

            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">by</span><span class="p">,</span>
                <span class="n">collection</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="s1">&#39;n</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">midpart</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span>
                <span class="n">common</span><span class="o">.</span><span class="n">dict_counts</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">)):</span>

                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>

                <span class="n">k</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_keys</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="s1">&#39;pct</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">midpart</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="n">common</span><span class="o">.</span><span class="n">dict_set_percent</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">summarize_groups</span> <span class="k">else</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_percent_and_collapse</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="s1">&#39;unique&#39;</span><span class="p">):</span>

            <span class="n">shared_unique</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_total</span><span class="p">(</span>
                    <span class="n">common</span><span class="o">.</span><span class="n">shared_unique_foreach</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">op</span> <span class="o">=</span> <span class="n">method</span><span class="p">),</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s1">&#39;all&#39;</span>
                            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;interaction_type&#39;</span> <span class="k">else</span>
                        <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                    <span class="k">if</span> <span class="n">summarize_groups</span> <span class="k">else</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shared_unique</span><span class="p">(</span>
                    <span class="n">dct</span> <span class="o">=</span> <span class="n">collection</span><span class="p">,</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="p">,</span>
                    <span class="n">total_key</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;Total&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;interaction_type&#39;</span> <span class="k">else</span>
                        <span class="kc">None</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">summarize_groups</span><span class="p">:</span>

                <span class="n">shared_unique_flat</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">dict_collapse_keys</span><span class="p">(</span><span class="n">shared_unique</span><span class="p">)</span>

            <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">midpart</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
            <span class="n">n_attr</span> <span class="o">=</span> <span class="s1">&#39;n_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">attr</span>
            <span class="n">pct_attr</span> <span class="o">=</span> <span class="s1">&#39;pct_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">attr</span>

            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">attr</span><span class="p">,</span>
                <span class="n">shared_unique</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">n_attr</span><span class="p">,</span>
                <span class="n">common</span><span class="o">.</span><span class="n">dict_collapse_keys</span><span class="p">(</span>
                    <span class="n">common</span><span class="o">.</span><span class="n">dict_counts</span><span class="p">(</span><span class="n">shared_unique</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">pct_attr</span><span class="p">,</span>
                <span class="n">common</span><span class="o">.</span><span class="n">dict_collapse_keys</span><span class="p">(</span>
                    <span class="n">common</span><span class="o">.</span><span class="n">dict_set_percent</span><span class="p">(</span><span class="n">shared_unique</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">summarize_groups</span> <span class="k">else</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_percent_and_collapse</span><span class="p">(</span><span class="n">shared_unique</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>


    <span class="k">def</span> <span class="nf">_expand_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">common</span><span class="o">.</span><span class="n">dict_expand_keys</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="p">,</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">front</span> <span class="o">=</span> <span class="n">level</span> <span class="o">==</span> <span class="s1">&#39;interaction_type&#39;</span><span class="p">,</span>
        <span class="p">)</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_shared_unique</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">total_key</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_add_total</span><span class="p">(</span>
                    <span class="n">common</span><span class="o">.</span><span class="n">shared_unique_foreach</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">op</span> <span class="o">=</span> <span class="n">method</span><span class="p">),</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">total_key</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
        <span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_total</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">basestring</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>

            <span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">first_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">())</span>

            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>

                <span class="n">_key</span> <span class="o">=</span> <span class="n">key</span><span class="p">(</span><span class="n">first_key</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">_key</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;Total&#39;</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_key</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">basestring</span><span class="p">)</span> <span class="k">else</span>
                    <span class="n">first_key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,)</span>
                <span class="p">)</span>

        <span class="n">dct</span><span class="p">[</span><span class="n">_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">dict_union</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dct</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_percent_and_collapse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">common</span><span class="o">.</span><span class="n">dict_collapse_keys</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span>
                        <span class="n">common</span><span class="o">.</span><span class="n">dict_set_percent</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<span class="n">NetworkStatsRecord</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s1">&#39;NetworkStatsRecord&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s1">&#39;total&#39;</span><span class="p">,</span>
        <span class="s1">&#39;by_resource&#39;</span><span class="p">,</span>
        <span class="s1">&#39;by_category&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique&#39;</span><span class="p">,</span>
        <span class="s1">&#39;percent&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared_res_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_res_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;percent_res_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;shared_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;unique_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;percent_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;resource_cat&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cat_resource&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method&#39;</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">NetworkStatsRecord</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">11</span>


<div class="viewcode-block" id="Network"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network">[docs]</a><span class="k">class</span> <span class="nc">Network</span><span class="p">(</span><span class="n">session_mod</span><span class="o">.</span><span class="n">Logger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a molecular interaction network. Provides various methods to</span>
<span class="sd">    query the network and its components. Optionally converts the network</span>
<span class="sd">    to a ``pandas.DataFrame`` of interactions.</span>

<span class="sd">    :arg list,dict resources:</span>
<span class="sd">        One or more lists or dictionaries containing</span>
<span class="sd">        ``pypath.resource.NetworkResource`` objects.</span>
<span class="sd">    :arg bool make_df:</span>
<span class="sd">        Create a ``pandas.DataFrame`` already when creating the instance.</span>
<span class="sd">        If no network data loaded no data frame will be created.</span>
<span class="sd">    :arg int ncbi_tax_id:</span>
<span class="sd">        Restrict the network only to this organism. If ``None`` identifiers</span>
<span class="sd">        from any organism will be allowed.</span>
<span class="sd">    :arg bool allow_loops:</span>
<span class="sd">        Allow interactions with the their two endpoints being the same entity.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_partners_methods</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span>
            <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;transcriptionally_&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;interaction_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;transcriptional&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;mirna_transcriptional&#39;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s1">&#39;post_transcriptionally_&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;interaction_type&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;post_transcriptional&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;lncrna_post_transcriptional&#39;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s1">&#39;post_translationally_&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;interaction_type&#39;</span><span class="p">:</span> <span class="s1">&#39;post_translational&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;regulat&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;direction&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s1">&#39;activat&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;effect&#39;</span><span class="p">:</span> <span class="s1">&#39;positive&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s1">&#39;suppress&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;effect&#39;</span><span class="p">:</span> <span class="s1">&#39;negative&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;es&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s1">&#39;ed_by&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;OUT&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">},</span>
    <span class="p">)</span>


<div class="viewcode-block" id="Network.__init__"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">make_df</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">df_by_source</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">df_with_references</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">df_columns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">df_dtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">pickle_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>

        <span class="n">session_mod</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;network&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Creating network object.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df_by_source</span> <span class="o">=</span> <span class="n">df_by_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_with_references</span> <span class="o">=</span> <span class="n">df_with_references</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_columns</span> <span class="o">=</span> <span class="n">df_columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_dtype</span> <span class="o">=</span> <span class="n">df_dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">cache_mod</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_original_names</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network_keep_original_names&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_name_types</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default_name_types&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pickle_file</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_pickle</span><span class="p">(</span><span class="n">pickle_file</span> <span class="o">=</span> <span class="n">pickle_file</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span><span class="p">,</span> <span class="n">make_df</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.reload"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.reload">[docs]</a>    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reloads the object from the module level.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">fromlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>

            <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">entity_mod</span><span class="p">)</span>
            <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">interaction_mod</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

                <span class="n">entity</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">Entity</span>

            <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

                <span class="n">interaction</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">interaction_mod</span><span class="o">.</span><span class="n">Interaction</span>
                <span class="n">interaction</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">Entity</span>
                <span class="n">interaction</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">Entity</span></div>


    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

            <span class="k">yield</span> <span class="n">ia</span>


    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">other</span> <span class="ow">in</span> <span class="n">ia</span> <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


<div class="viewcode-block" id="Network.reset"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes network data i.e. creates empty interaction and node</span>
<span class="sd">        dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_by_label</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.load"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">make_df</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">reread</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">redownload</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">keep_raw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">top_call</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">cache_files</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">only_directions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">pickle_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">first_n</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads data from a network resource or a collection of resources.</span>

<span class="sd">        :arg str,dict,list,resource.NetworkResource resources:</span>
<span class="sd">            An object defining one or more network resources. If *str* it</span>
<span class="sd">            will be looked up among the collections in the</span>
<span class="sd">            ``pypath.resources.network`` module (e.g. ``&#39;pathway&#39;`` will load</span>
<span class="sd">            all resources in the `pathway` collection). If *dict* or *list*</span>
<span class="sd">            it will be processed recursively i.e. the ``load`` method will be</span>
<span class="sd">            called for each element. If it is a</span>
<span class="sd">            ``pypath.resource.NetworkResource`` object it will be processed</span>
<span class="sd">            and added to the network.</span>
<span class="sd">        :arg bool make_df:</span>
<span class="sd">            Whether to create a ``pandas.DataFrame`` after loading all</span>
<span class="sd">            resources.</span>
<span class="sd">        :arg NoneType,set exclude:</span>
<span class="sd">            A *set* of resource names to be ignored. It is useful if you want</span>
<span class="sd">            to load a collection with the exception of a few resources.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pickle_file</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_pickle</span><span class="p">(</span><span class="n">pickle_file</span> <span class="o">=</span> <span class="n">pickle_file</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;reread&#39;</span><span class="p">:</span> <span class="n">reread</span><span class="p">,</span>
            <span class="s1">&#39;redownload&#39;</span><span class="p">:</span> <span class="n">redownload</span><span class="p">,</span>
            <span class="s1">&#39;keep_raw&#39;</span><span class="p">:</span> <span class="n">keep_raw</span><span class="p">,</span>
            <span class="s1">&#39;top_call&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;only_directions&#39;</span><span class="p">:</span> <span class="n">only_directions</span><span class="p">,</span>
            <span class="s1">&#39;allow_loops&#39;</span><span class="p">:</span> <span class="n">allow_loops</span><span class="p">,</span>
            <span class="s1">&#39;first_n&#39;</span><span class="p">:</span> <span class="n">first_n</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">exclude</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>

        <span class="n">resources</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">resources</span><span class="p">,)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">))</span> <span class="k">else</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">)</span> <span class="k">else</span>
            <span class="n">resources</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">network_resources</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
            <span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="n">resources</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">network_resources</span><span class="p">,</span> <span class="n">resource</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="n">resources</span> <span class="o">=</span> <span class="n">resource</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">resource</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="n">network_resources</span><span class="o">.</span><span class="n">data_formats</span><span class="o">.</span>\
                            <span class="n">input_formats</span><span class="o">.</span><span class="n">NetworkInput</span><span class="p">,</span>
                        <span class="n">network_resources</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">NetworkResource</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="n">resource</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span>
            <span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">load_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                    <span class="s1">&#39;Could not recognize network input &#39;</span>
                    <span class="s1">&#39;definition: `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">make_df</span> <span class="ow">and</span> <span class="n">top_call</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">make_df</span><span class="p">()</span></div>


    <span class="c1"># synonyms (old method names of PyPath)</span>
    <span class="n">load_resources</span> <span class="o">=</span> <span class="n">load</span>
    <span class="n">init_network</span> <span class="o">=</span> <span class="n">load</span>


<div class="viewcode-block" id="Network.load_resource"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.load_resource">[docs]</a>    <span class="k">def</span> <span class="nf">load_resource</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">clean</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">reread</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">redownload</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">keep_raw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">only_directions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">first_n</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the data from a single resource and attaches it to the</span>
<span class="sd">        network</span>

<span class="sd">        :arg pypath.input_formats.NetworkInput resource:</span>
<span class="sd">            :py:class:`pypath.input_formats.NetworkInput` instance</span>
<span class="sd">            containing the detailed definition of the input format to</span>
<span class="sd">            the downloaded file.</span>
<span class="sd">        :arg bool clean:</span>
<span class="sd">            Legacy parameter, has no effect at the moment.</span>
<span class="sd">            Optional, ``True`` by default. Whether to clean the graph</span>
<span class="sd">            after importing the data or not. See</span>
<span class="sd">            :py:meth:`pypath.main.PyPath.clean_graph` for more</span>
<span class="sd">            information.</span>
<span class="sd">        :arg dict cache_files:</span>
<span class="sd">            Legacy parameter, has no effect at the moment.</span>
<span class="sd">            Optional, ``{}`` by default. Contains the resource name(s)</span>
<span class="sd">            [str] (keys) and the corresponding cached file name [str].</span>
<span class="sd">            If provided (and file exists) bypasses the download of the</span>
<span class="sd">            data for that resource and uses the cache file instead.</span>
<span class="sd">        :arg bool reread:</span>
<span class="sd">            Optional, ``False`` by default. Specifies whether to reread</span>
<span class="sd">            the data files from the cache or omit them (similar to</span>
<span class="sd">            *redownload*).</span>
<span class="sd">        :arg bool redownload:</span>
<span class="sd">            Optional, ``False`` by default. Specifies whether to</span>
<span class="sd">            re-download the data and ignore the cache.</span>
<span class="sd">        :arg bool only_directions:</span>
<span class="sd">            If ``True``, no new interactions will be created but direction</span>
<span class="sd">            and effect sign evidences will be added to existing interactions.</span>
<span class="sd">        :arg int first_n:</span>
<span class="sd">            Load only the first n interactions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">total_attempts</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network_load_resource_attempts&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_attempts</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Loading network data from resource `</span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">`&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39; (dataset: </span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">dataset</span><span class="si">}</span><span class="s1">); &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">total_attempts</span><span class="si">}</span><span class="s1">.&#39;</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_read_resource</span><span class="p">(</span>
                    <span class="n">resource</span><span class="p">,</span>
                    <span class="n">reread</span> <span class="o">=</span> <span class="n">reread</span><span class="p">,</span>
                    <span class="n">redownload</span> <span class="o">=</span> <span class="n">redownload</span><span class="p">,</span>
                    <span class="n">keep_raw</span> <span class="o">=</span> <span class="n">keep_raw</span><span class="p">,</span>
                    <span class="n">first_n</span> <span class="o">=</span> <span class="n">first_n</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                    <span class="s1">&#39;Successfully read interactions &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;from resource `</span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">`.&#39;</span>
                <span class="p">)</span>
                <span class="k">break</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                <span class="n">exc</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                    <span class="s1">&#39;Failed to read interactions &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;from resource `</span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">`:&#39;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_traceback</span><span class="p">(</span><span class="n">console</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">total_attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Not loading `</span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">`: giving up after &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">total_attempts</span><span class="si">}</span><span class="s1"> attempts.&#39;</span>
                    <span class="p">)</span>
                    <span class="k">return</span>

        <span class="n">allow_loops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_loops</span><span class="p">(</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">,</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Loops allowed for resource `</span><span class="si">%s</span><span class="s1">`: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">allow_loops</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_edge_list</span><span class="p">(</span>
            <span class="n">only_directions</span> <span class="o">=</span> <span class="n">only_directions</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">organisms_check</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_zero_degree</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Completed: loading network data from &#39;</span>
            <span class="s1">&#39;resource `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">resource</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_read_resource</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">reread</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">redownload</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">keep_raw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">cache_files</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">first_n</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads interaction data file containing node and edge attributes</span>
<span class="sd">        that can be read from simple text based files and adds it to the</span>
<span class="sd">        networkdata. This function works not only with files, but with</span>
<span class="sd">        lists as well. Any other function can be written to download and</span>
<span class="sd">        preprocess data, and then give it to this function to finally</span>
<span class="sd">        attach to the network.</span>

<span class="sd">        :arg pypath.input_formats.NetworkInput resource:</span>
<span class="sd">            :py:class:`pypath.input_formats.NetworkInput` instance</span>
<span class="sd">            containing the detailed definition of the input format of</span>
<span class="sd">            the file. Instead of the file name (on the</span>
<span class="sd">            :py:attr:`pypath.input_formats.NetworkInput.input`</span>
<span class="sd">            attribute) you can give a custom function name, which will</span>
<span class="sd">            be executed, and the returned data will be used instead.</span>
<span class="sd">        :arg bool keep_raw:</span>
<span class="sd">            Optional, ``False`` by default. Whether to keep the raw data</span>
<span class="sd">            read by this function, in order for debugging purposes, or</span>
<span class="sd">            further use.</span>
<span class="sd">        :arg dict cache_files:</span>
<span class="sd">            Optional, ``{}`` by default. Contains the resource name(s)</span>
<span class="sd">            [str] (keys) and the corresponding cached file name [str].</span>
<span class="sd">            If provided (and file exists) bypasses the download of the</span>
<span class="sd">            data for that resource and uses the cache file instead.</span>
<span class="sd">        :arg bool reread:</span>
<span class="sd">            Optional, ``False`` by default. Specifies whether to reread</span>
<span class="sd">            the data files from the cache or omit them (similar to</span>
<span class="sd">            *redownload*).</span>
<span class="sd">        :arg bool redownload:</span>
<span class="sd">            Optional, ``False`` by default. Specifies whether to</span>
<span class="sd">            re-download the data and ignore the cache.</span>
<span class="sd">        :arg int first_n:</span>
<span class="sd">            Load only the first n interactions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Reading network data from `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">SMOL_TYPES</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;small_molecule_entity_types&#39;</span><span class="p">)</span>

        <span class="c1"># workaround in order to make it work with both NetworkInput</span>
        <span class="c1"># and NetworkResource type param</span>
        <span class="n">_resource</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">resource</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">resource</span><span class="p">,</span>
                    <span class="n">network_resources</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">NetworkResource</span>
                <span class="p">)</span> <span class="k">else</span>
            <span class="n">network_resources</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">NetworkResource</span><span class="p">(</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">interaction_type</span><span class="p">,</span>
                <span class="n">networkinput</span> <span class="o">=</span> <span class="n">resource</span><span class="p">,</span>
                <span class="n">data_model</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">data_model</span> <span class="ow">or</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">networkinput</span> <span class="o">=</span> <span class="n">_resource</span><span class="o">.</span><span class="n">networkinput</span>

        <span class="n">_resources_secondary</span> <span class="o">=</span> <span class="p">()</span>

        <span class="n">expand_complexes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">networkinput</span><span class="o">.</span><span class="n">expand_complexes</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">expand_complexes</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network_expand_complexes&#39;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">reread</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">reread</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reread</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span>
            <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network_pickle_cache&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Expanding complexes for `</span><span class="si">%s</span><span class="s1">`: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">expand_complexes</span><span class="p">),</span>
        <span class="p">))</span>

        <span class="n">edge_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">edges_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">,</span>
            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.edges.pickle&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">_name</span><span class="p">,</span>
                <span class="n">_resource</span><span class="o">.</span><span class="n">data_model</span><span class="p">,</span>
                <span class="n">_resource</span><span class="o">.</span><span class="n">interaction_type</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">interaction_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span><span class="p">,</span>
            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.interactions.pickle&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">_name</span><span class="p">,</span>
                <span class="n">_resource</span><span class="o">.</span><span class="n">data_model</span><span class="p">,</span>
                <span class="n">_resource</span><span class="o">.</span><span class="n">interaction_type</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">reread</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">redownload</span><span class="p">:</span>

            <span class="n">infile</span><span class="p">,</span> <span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="p">(</span>
                <span class="n">_name</span><span class="p">,</span>
                <span class="n">cache_files</span><span class="p">,</span>
                <span class="n">interaction_cache</span><span class="p">,</span>
                <span class="n">edges_cache</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_list_mapped</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">resource</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="n">network_resources</span><span class="o">.</span><span class="n">data_formats</span><span class="o">.</span>\
                            <span class="n">input_formats</span><span class="o">.</span><span class="n">NetworkInput</span><span class="p">,</span>
                        <span class="n">network_resources</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">NetworkResource</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">):</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                        <span class="s1">&#39;_read_network_data: No proper input file &#39;</span>
                        <span class="s1">&#39;definition. `param` should be either &#39;</span>
                        <span class="s1">&#39;a `pypath.input_formats.NetworkInput` or a &#39;</span>
                        <span class="s1">&#39;`pypath.resource.NetworkResource` instance.&#39;</span><span class="p">,</span>
                        <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="k">return</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">huge</span><span class="p">:</span>

                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Processing </span><span class="si">%s</span><span class="s1"> requires huge memory.</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Please hit `y` if you have at &#39;</span>
                        <span class="s1">&#39;least 2G free memory,</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">or `n` to omit </span><span class="si">%s</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">After processing once, it will be saved in </span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">, so next time can be loaded quickly.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Process </span><span class="si">%s</span><span class="s1"> now? [y/n]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="p">(</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">edges_cache</span><span class="p">,</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">answer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span>

                        <span class="k">elif</span> <span class="n">answer</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">break</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Please answer `y` or `n`:</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                <span class="c1"># if no method available it gonna be None</span>
                <span class="n">input_func</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get_method</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>

                <span class="c1"># reading from remote or local file, or executing import</span>
                <span class="c1"># function:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ftp&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">curl_use_cache</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">redownload</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">curl</span><span class="o">.</span><span class="n">Curl</span><span class="p">(</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                        <span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">large</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">cache</span> <span class="o">=</span> <span class="n">curl_use_cache</span>
                    <span class="p">)</span>
                    <span class="n">infile</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">infile</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

                        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">infile</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;iso-8859-1&#39;</span><span class="p">)</span>

                            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>

                                <span class="k">raise</span> <span class="n">e</span>

                    <span class="n">infile</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                        <span class="s2">&quot;Retrieving data from `</span><span class="si">%s</span><span class="s2">` ...&quot;</span> <span class="o">%</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span>
                    <span class="p">)</span>

                <span class="k">elif</span> <span class="n">input_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                        <span class="s1">&#39;Retrieving data by method `</span><span class="si">%s</span><span class="s1">` of the &#39;</span>
                        <span class="s1">&#39;pypath.inputs module...&#39;</span> <span class="o">%</span> <span class="n">input_func</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="p">)</span>

                    <span class="n">_store_cache</span> <span class="o">=</span> <span class="n">curl</span><span class="o">.</span><span class="n">CACHE</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">redownload</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>

                        <span class="n">curl</span><span class="o">.</span><span class="n">CACHE</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">redownload</span>

                    <span class="k">try</span><span class="p">:</span>

                        <span class="n">infile</span> <span class="o">=</span> <span class="n">input_func</span><span class="p">(</span><span class="o">**</span><span class="n">networkinput</span><span class="o">.</span><span class="n">input_args</span><span class="p">)</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Error in method `</span><span class="si">{</span><span class="n">input_func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">` of the &#39;</span>
                            <span class="s1">&#39;pypath.inputs module. &#39;</span>
                        <span class="p">)</span>

                        <span class="k">raise</span> <span class="n">e</span>

                    <span class="k">finally</span><span class="p">:</span>

                        <span class="n">curl</span><span class="o">.</span><span class="n">CACHE</span> <span class="o">=</span> <span class="n">_store_cache</span>

                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">):</span>

                    <span class="n">infile</span> <span class="o">=</span> <span class="n">curl</span><span class="o">.</span><span class="n">Curl</span><span class="p">(</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                        <span class="n">large</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">result</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> opened...&#39;</span> <span class="o">%</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">infile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                        <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">`: Could not find file or input function &#39;</span>
                        <span class="s1">&#39;or failed preprocessing.&#39;</span> <span class="o">%</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                        <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

            <span class="n">is_directed</span> <span class="o">=</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">is_directed</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">sign</span>
            <span class="n">ref_col</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">networkinput</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span>
                <span class="n">networkinput</span><span class="o">.</span><span class="n">refs</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span>
                <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">ref_sep</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">networkinput</span><span class="o">.</span><span class="n">refs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">refs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span>
                <span class="s1">&#39;;&#39;</span>
            <span class="p">)</span>
            <span class="c1"># column index of the sign</span>
            <span class="n">sig_col</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># column index and value(s) for the direction</span>
            <span class="n">dir_col</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dir_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dir_sep</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_directed</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

                <span class="n">dir_col</span> <span class="o">=</span> <span class="n">is_directed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dir_val</span> <span class="o">=</span> <span class="n">is_directed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dir_sep</span> <span class="o">=</span> <span class="n">is_directed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">is_directed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

                <span class="n">dir_col</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dir_val</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">dir_val</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">dir_val</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dir_val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="n">common</span><span class="o">.</span><span class="n">simple_types</span> <span class="k">else</span>
                    <span class="n">common</span><span class="o">.</span><span class="n">flat_list</span><span class="p">(</span><span class="n">dir_val</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">dir_sep</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="n">dir_val</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">dir_val</span><span class="p">)</span>

            <span class="n">must_have_references</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keep_noref&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">networkinput</span><span class="o">.</span><span class="n">must_have_references</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                <span class="s1">&#39;Resource `</span><span class="si">%s</span><span class="s1">` </span><span class="si">%s</span><span class="s1"> have literature references &#39;</span>
                <span class="s1">&#39;for all interactions. Interactions without references &#39;</span>
                <span class="s1">&#39;will be </span><span class="si">%s</span><span class="s1">. You can alter this condition globally by &#39;</span>
                <span class="s1">&#39;`pypath.settings.keep_noref` or for individual resources &#39;</span>
                <span class="s1">&#39;by the `must_have_references` attribute of their &#39;</span>
                <span class="s1">&#39;`NetworkInput` object.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s1">&#39;must&#39;</span> <span class="k">if</span> <span class="n">must_have_references</span> <span class="k">else</span> <span class="s1">&#39;does not need to&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;dropped&#39;</span> <span class="k">if</span> <span class="n">must_have_references</span> <span class="k">else</span> <span class="s1">&#39;included&#39;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">` must have references: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">must_have_references</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># iterating lines from input file</span>
            <span class="n">input_filtered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ref_filtered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">taxon_filtered</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">read_error</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">lnum</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># we need to define it here to avoid errors if the</span>
                     <span class="c1"># loop below runs zero cycles</span>

            <span class="n">prg</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">Progress</span><span class="p">(</span>
                <span class="n">iterable</span> <span class="o">=</span> <span class="n">infile</span><span class="p">,</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Reading network data - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">lnum</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prg</span><span class="p">):</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lnum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                        <span class="c1"># empty lines</span>
                        <span class="c1"># or header row</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>

                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39;decode&#39;</span><span class="p">):</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\r</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span> <span class="k">else</span>
                            <span class="n">x</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span>
                        <span class="p">]</span>

                    <span class="c1"># 1) filters</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">(</span>
                        <span class="n">line</span><span class="p">,</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">positive_filters</span><span class="p">,</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">negative_filters</span>
                    <span class="p">):</span>

                        <span class="n">input_filtered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>

                    <span class="c1"># 2) direction</span>
                    <span class="c1"># reading names and attributes:</span>
                    <span class="k">if</span> <span class="n">is_directed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_directed</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

                        <span class="n">this_edge_dir</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">this_edge_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_direction</span><span class="p">(</span>
                            <span class="n">line</span><span class="p">,</span>
                            <span class="n">dir_col</span><span class="p">,</span>
                            <span class="n">dir_val</span><span class="p">,</span>
                            <span class="n">dir_sep</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="c1"># 3) references</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">if</span> <span class="n">ref_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">ref_col</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                            <span class="n">refs</span> <span class="o">=</span> <span class="p">()</span>

                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">ref_col</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>

                            <span class="n">refs</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">ref_col</span><span class="p">]</span>

                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">ref_col</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>

                            <span class="n">refs</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">ref_col</span><span class="p">],)</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">refs</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">ref_col</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ref_sep</span><span class="p">)</span>

                        <span class="n">refs</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">del_empty</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">refs</span><span class="p">)))</span>

                    <span class="n">refs</span> <span class="o">=</span> <span class="n">pubmed_input</span><span class="o">.</span><span class="n">only_pmids</span><span class="p">(</span>
                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">]</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">must_have_references</span><span class="p">:</span>

                        <span class="n">ref_filtered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>

                    <span class="c1"># 4) entity types</span>
                    <span class="n">entity_type_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_field</span><span class="p">(</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">entity_type_a</span><span class="p">,</span>
                        <span class="n">line</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">entity_type_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_field</span><span class="p">(</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">entity_type_b</span><span class="p">,</span>
                        <span class="n">line</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="c1"># 5) ID types</span>
                    <span class="n">id_type_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_field</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">id_type_a</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">id_type_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_field</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">id_type_b</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

                    <span class="c1"># 6) organisms</span>
                    <span class="c1"># to give an easy way for input definition:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>

                        <span class="n">taxon_a</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">constants</span><span class="o">.</span><span class="n">NOT_ORGANISM_SPECIFIC</span>
                                <span class="k">if</span> <span class="n">entity_type_a</span> <span class="ow">in</span> <span class="n">SMOL_TYPES</span> <span class="k">else</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
                        <span class="p">)</span>
                        <span class="n">taxon_b</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">constants</span><span class="o">.</span><span class="n">NOT_ORGANISM_SPECIFIC</span>
                                <span class="k">if</span> <span class="n">entity_type_b</span> <span class="ow">in</span> <span class="n">SMOL_TYPES</span> <span class="k">else</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
                        <span class="p">)</span>

                    <span class="c1"># to enable more sophisticated inputs:</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

                        <span class="n">taxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_taxon</span><span class="p">(</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span>
                            <span class="n">line</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">taxx</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

                            <span class="n">taxon_a</span><span class="p">,</span> <span class="n">taxon_b</span> <span class="o">=</span> <span class="n">taxx</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">taxon_a</span> <span class="o">=</span> <span class="n">taxon_b</span> <span class="o">=</span> <span class="n">taxx</span>

                        <span class="n">taxd_a</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span>
                                <span class="k">if</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="k">else</span>
                            <span class="n">constants</span><span class="o">.</span><span class="n">NOT_ORGANISM_SPECIFIC</span>
                                <span class="k">if</span> <span class="n">entity_type_a</span> <span class="ow">in</span> <span class="n">SMOL_TYPES</span> <span class="k">else</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
                        <span class="p">)</span>
                        <span class="n">taxd_b</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
                                <span class="k">if</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span> <span class="k">else</span>
                            <span class="n">constants</span><span class="o">.</span><span class="n">NOT_ORGANISM_SPECIFIC</span>
                                <span class="k">if</span> <span class="n">entity_type_b</span> <span class="ow">in</span> <span class="n">SMOL_TYPES</span> <span class="k">else</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
                        <span class="p">)</span>

                        <span class="n">only_default</span> <span class="o">=</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">only_default_organism</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_match_taxon</span><span class="p">(</span><span class="n">taxd_a</span><span class="p">,</span> <span class="n">taxon_a</span><span class="p">,</span> <span class="n">only_default</span><span class="p">)</span> <span class="ow">and</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_match_taxon</span><span class="p">(</span><span class="n">taxd_b</span><span class="p">,</span> <span class="n">taxon_b</span><span class="p">,</span> <span class="n">only_default</span><span class="p">)</span>
                        <span class="p">):</span>

                            <span class="n">taxon_filtered</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">continue</span>

                    <span class="c1"># assuming by default the default organism</span>
                    <span class="k">else</span><span class="p">:</span>

                        <span class="n">taxon_a</span> <span class="o">=</span> <span class="n">taxon_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>

                    <span class="k">if</span> <span class="n">taxon_a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">taxon_b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                        <span class="n">taxon_filtered</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>

                    <span class="c1"># 7) effect (sign)</span>
                    <span class="n">positive</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">negative</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

                        <span class="n">positive</span><span class="p">,</span> <span class="n">negative</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_process_sign</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">sign</span><span class="p">)</span>
                        <span class="p">)</span>

                    <span class="c1"># 8) resources (source databases)</span>
                    <span class="n">resource</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">line</span><span class="p">[</span><span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span>
                        <span class="n">line</span><span class="p">[</span><span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                            <span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span>
                                <span class="nb">hasattr</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;split&#39;</span><span class="p">)</span>
                            <span class="p">)</span> <span class="k">else</span>
                        <span class="p">[]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">resource</span>
                    <span class="p">)</span>

                    <span class="n">resource</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>

                    <span class="n">_resources_secondary</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                        <span class="n">network_resources</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">NetworkResource</span><span class="p">(</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">sec_res</span><span class="p">,</span>
                            <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">_resource</span><span class="o">.</span><span class="n">interaction_type</span><span class="p">,</span>
                            <span class="n">data_model</span> <span class="o">=</span> <span class="n">_resource</span><span class="o">.</span><span class="n">data_model</span><span class="p">,</span>
                            <span class="n">via</span> <span class="o">=</span> <span class="n">_resource</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">dataset</span> <span class="o">=</span> <span class="n">_resource</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">sec_res</span> <span class="ow">in</span> <span class="n">resource</span>
                        <span class="k">if</span> <span class="n">sec_res</span> <span class="o">!=</span> <span class="n">_resource</span><span class="o">.</span><span class="n">name</span>
                    <span class="p">)</span>

                    <span class="n">resource</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                    <span class="c1"># 9) interacting partners</span>
                    <span class="n">id_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_partner</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">id_col_a</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">id_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_partner</span><span class="p">(</span><span class="n">networkinput</span><span class="o">.</span><span class="n">id_col_b</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

                    <span class="c1"># 10) further attributes</span>
                    <span class="c1"># getting additional edge and node attributes</span>
                    <span class="n">attrs_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_attrs</span><span class="p">(</span>
                        <span class="n">line</span><span class="p">,</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">extra_edge_attrs</span><span class="p">,</span>
                        <span class="n">lnum</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">attrs_node_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_attrs</span><span class="p">(</span>
                        <span class="n">line</span><span class="p">,</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">extra_node_attrs_a</span><span class="p">,</span>
                        <span class="n">lnum</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">attrs_node_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_attrs</span><span class="p">(</span>
                        <span class="n">line</span><span class="p">,</span>
                        <span class="n">networkinput</span><span class="o">.</span><span class="n">extra_node_attrs_b</span><span class="p">,</span>
                        <span class="n">lnum</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="c1"># 11) creating the Evidence object</span>
                    <span class="n">evidences</span> <span class="o">=</span> <span class="n">evidence</span><span class="o">.</span><span class="n">Evidences</span><span class="p">(</span>
                        <span class="n">evidences</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">evidence</span><span class="o">.</span><span class="n">Evidence</span><span class="p">(</span>
                                <span class="n">resource</span> <span class="o">=</span> <span class="n">_res</span><span class="p">,</span>
                                <span class="n">references</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">_res</span><span class="o">.</span><span class="n">via</span> <span class="k">else</span> <span class="n">refs</span><span class="p">,</span>
                                <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs_edge</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="k">for</span> <span class="n">_res</span> <span class="ow">in</span>
                            <span class="n">_resources_secondary</span> <span class="o">+</span> <span class="p">(</span><span class="n">_resource</span><span class="p">,)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                    <span class="c1"># 12) node attributes that</span>
                    <span class="c1">#     depend on the interaction direction</span>
                    <span class="k">if</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">mark_source</span><span class="p">:</span>

                        <span class="n">attrs_node_a</span><span class="p">[</span><span class="n">networkinput</span><span class="o">.</span><span class="n">mark_source</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_edge_dir</span>

                    <span class="k">if</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">mark_target</span><span class="p">:</span>

                        <span class="n">attrs_node_b</span><span class="p">[</span><span class="n">networkinput</span><span class="o">.</span><span class="n">mark_target</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_edge_dir</span>

                    <span class="c1"># 13) all interaction data goes into a dict</span>
                    <span class="n">new_edge</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;id_a&#39;</span><span class="p">:</span> <span class="n">id_a</span><span class="p">,</span>
                        <span class="s1">&#39;id_b&#39;</span><span class="p">:</span> <span class="n">id_b</span><span class="p">,</span>
                        <span class="s1">&#39;id_type_a&#39;</span><span class="p">:</span> <span class="n">id_type_a</span><span class="p">,</span>
                        <span class="s1">&#39;id_type_b&#39;</span><span class="p">:</span> <span class="n">id_type_b</span><span class="p">,</span>
                        <span class="s1">&#39;entity_type_a&#39;</span><span class="p">:</span> <span class="n">entity_type_a</span><span class="p">,</span>
                        <span class="s1">&#39;entity_type_b&#39;</span><span class="p">:</span> <span class="n">entity_type_b</span><span class="p">,</span>
                        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
                        <span class="s1">&#39;is_directed&#39;</span><span class="p">:</span> <span class="n">this_edge_dir</span><span class="p">,</span>
                        <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">refs</span><span class="p">,</span>
                        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="n">positive</span><span class="p">,</span>
                        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="n">negative</span><span class="p">,</span>
                        <span class="s1">&#39;taxon_a&#39;</span><span class="p">:</span> <span class="n">taxon_a</span><span class="p">,</span>
                        <span class="s1">&#39;taxon_b&#39;</span><span class="p">:</span> <span class="n">taxon_b</span><span class="p">,</span>
                        <span class="s1">&#39;interaction_type&#39;</span><span class="p">:</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">interaction_type</span><span class="p">,</span>
                        <span class="s1">&#39;evidences&#39;</span><span class="p">:</span> <span class="n">evidences</span><span class="p">,</span>
                        <span class="s1">&#39;attrs_node_a&#39;</span><span class="p">:</span> <span class="n">attrs_node_a</span><span class="p">,</span>
                        <span class="s1">&#39;attrs_node_b&#39;</span><span class="p">:</span> <span class="n">attrs_node_b</span><span class="p">,</span>
                        <span class="s1">&#39;attrs_edge&#39;</span><span class="p">:</span> <span class="n">attrs_edge</span><span class="p">,</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="n">read_error</span><span class="p">:</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                            <span class="s1">&#39;Errors occured, certain lines skipped.&#39;</span>
                            <span class="s1">&#39;Trying to read the remaining.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="mi">5</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="n">edge_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_edge</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">first_n</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">first_n</span><span class="p">:</span>

                        <span class="k">break</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                    <span class="s1">&#39;Error at loading resource `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">networkinput</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>

                <span class="k">raise</span> <span class="n">e</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>

                <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># 14) ID translation of edges</span>
            <span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_list</span><span class="p">(</span>
                <span class="n">edge_list</span><span class="p">,</span>
                <span class="n">expand_complexes</span> <span class="o">=</span> <span class="n">expand_complexes</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> lines have been read from </span><span class="si">%s</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> links after mapping; &#39;</span>
                <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> lines filtered by filters; &#39;</span>
                <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> lines filtered because lack of references; &#39;</span>
                <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> lines filtered by taxon filters.&#39;</span> <span class="o">%</span>
                <span class="p">(</span>
                    <span class="n">lnum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">networkinput</span><span class="o">.</span><span class="n">input</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">edge_list_mapped</span><span class="p">),</span>
                    <span class="n">input_filtered</span><span class="p">,</span>
                    <span class="n">ref_filtered</span><span class="p">,</span>
                    <span class="n">taxon_filtered</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">reread</span> <span class="ow">or</span> <span class="n">redownload</span><span class="p">:</span>

                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">edge_list_mapped</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;ID translated edge list saved to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">edges_cache</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                <span class="s1">&#39;Previously ID translated edge list &#39;</span>
                <span class="s1">&#39;has been loaded from `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">edges_cache</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">keep_raw</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="n">networkinput</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_list_mapped</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="n">edge_list_mapped</span>


    <span class="k">def</span> <span class="nf">_lookup_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cache_files</span><span class="p">,</span> <span class="n">int_cache</span><span class="p">,</span> <span class="n">edges_cache</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks up the cache folder for the files of a given resource.</span>
<span class="sd">        First checks if *name* is on the *cache_files* dictionary.</span>
<span class="sd">        If so, loads either the interactions or edges otherwise. If</span>
<span class="sd">        not, checks *edges_cache* or *int_cache* otherwise.</span>

<span class="sd">        :arg str name:</span>
<span class="sd">            Name of the resource (lower-case).</span>
<span class="sd">        :arg dict cache_files:</span>
<span class="sd">            Contains the resource name(s) [str] (keys) and the</span>
<span class="sd">            corresponding cached file name [str] (values).</span>
<span class="sd">        :arg str int_cache:</span>
<span class="sd">            Path to the interactions cache file of the resource.</span>
<span class="sd">        :arg str edges_cache:</span>
<span class="sd">            Path to the edges cache file of the resource.</span>

<span class="sd">        :return:</span>
<span class="sd">            * (*file*) -- The loaded pickle file from the cache if the</span>
<span class="sd">              file is contains the interactions. ``None`` otherwise.</span>
<span class="sd">            * (*list*) -- List of mapped edges if the file contains the</span>
<span class="sd">              information from the edges. ``[]`` otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cache_files</span> <span class="o">=</span> <span class="n">cache_files</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cache_file</span> <span class="o">=</span> <span class="n">cache_files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cache_files</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">cache_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_file</span><span class="p">):</span>
            <span class="n">cache_type</span> <span class="o">=</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">cache_type</span> <span class="o">==</span> <span class="s1">&#39;interactions&#39;</span><span class="p">:</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">int_cache</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">cache_type</span> <span class="o">==</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span>
                <span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">):</span>
            <span class="n">edge_list_mapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">edges_cache</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">int_cache</span><span class="p">):</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_from_cache</span><span class="p">(</span><span class="n">int_cache</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">infile</span><span class="p">,</span> <span class="n">edge_list_mapped</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_filters</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">line</span><span class="p">,</span>
            <span class="n">positive_filters</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">negative_filters</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies negative and positive filters on a line (record from an</span>
<span class="sd">        interaction database). If returns ``True`` the interaction will be</span>
<span class="sd">        discarded, if ``False`` the interaction will be further processed</span>
<span class="sd">        and if all other criteria fit then will be added to the network</span>
<span class="sd">        after identifier translation.</span>

<span class="sd">        Return</span>
<span class="sd">            (bool): True if the line should be filtered (removed), False</span>
<span class="sd">                if all filters passed, the record can be further processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_process_filters</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">negative_filters</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_process_filters</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">positive_filters</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_process_filters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">filters</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">negate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args</span>
<span class="sd">            negate (bool): Whether to negate the filter matches. Sorry for</span>
<span class="sd">                the confusion, but it should be True for positive filters</span>
<span class="sd">                and False for negatives.</span>


<span class="sd">        Return</span>
<span class="sd">            (bool): True if the line should be filtered (removed), False</span>
<span class="sd">                if all filters passed, the record can be further processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_negate</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">negate</span> <span class="k">else</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">()</span>

        <span class="k">for</span> <span class="n">filtr</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">_negate</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_process_filter</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">filtr</span><span class="p">)):</span>

                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_process_filter</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">filtr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return</span>
<span class="sd">            (bool): True if the filter matches.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">filtr</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">filtr</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>

                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>

                <span class="n">sep</span> <span class="o">=</span> <span class="n">filtr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">thisVal</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">thisVal</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">filtr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

            <span class="n">filtrVal</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">filtr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">thisVal</span> <span class="o">&amp;</span> <span class="n">filtrVal</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_process_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sign_data</span><span class="p">,</span> <span class="n">sign_def</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes the sign of an interaction, used when processing an</span>
<span class="sd">        input file.</span>

<span class="sd">        :arg str sign_data:</span>
<span class="sd">            Data regarding the sign to be processed.</span>
<span class="sd">        :arg tuple sign_def:</span>
<span class="sd">            Contains information about how to process *sign_data*. This</span>
<span class="sd">            is defined in :py:mod:`pypath.data_formats`. First element</span>
<span class="sd">            determines the position on the direction information of each</span>
<span class="sd">            line on the data file [int], second element is either [str]</span>
<span class="sd">            or [list] and defines the terms for which an interaction is</span>
<span class="sd">            defined as stimulation, third element is similar but for the</span>
<span class="sd">            inhibition and third (optional) element determines the</span>
<span class="sd">            separator for *sign_data* if contains more than one element.</span>

<span class="sd">        :return:</span>
<span class="sd">            * (*bool*) -- Determines whether the processed interaction</span>
<span class="sd">              is considered stimulation (positive) or not.</span>
<span class="sd">            * (*bool*) -- Determines whether the processed interaction</span>
<span class="sd">              is considered inhibition (negative) or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">positive</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">negative</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">sign_sep</span> <span class="o">=</span> <span class="n">sign_def</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sign_def</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">sign_data</span> <span class="o">=</span> <span class="n">sign_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sign_sep</span><span class="p">)</span> <span class="k">if</span> <span class="n">sign_sep</span> <span class="k">else</span> <span class="n">sign_data</span>
        <span class="n">sign_data</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">sign_data</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">sign_def</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">sign_def</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">sign_data</span> <span class="o">&amp;</span> <span class="n">pos</span><span class="p">):</span>

            <span class="n">positive</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">sign_data</span> <span class="o">&amp;</span> <span class="n">neg</span><span class="p">):</span>

            <span class="n">negative</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">positive</span><span class="p">,</span> <span class="n">negative</span>


    <span class="k">def</span> <span class="nf">_process_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">dir_col</span><span class="p">,</span> <span class="n">dir_val</span><span class="p">,</span> <span class="n">dir_sep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes the direction information of an interaction according</span>
<span class="sd">        to a data file from a source.</span>

<span class="sd">        :arg list line:</span>
<span class="sd">            The stripped and separated line from the resource data file</span>
<span class="sd">            containing the information of an interaction.</span>
<span class="sd">        :arg int dir_col:</span>
<span class="sd">            The column/position number where the information about the</span>
<span class="sd">            direction is to be found (on *line*).</span>
<span class="sd">        :arg list dir_val:</span>
<span class="sd">            Contains the terms [str] for which that interaction is to be</span>
<span class="sd">            considered directed.</span>
<span class="sd">        :arg str dir_sep:</span>
<span class="sd">            Separator for the field in *line* containing the direction</span>
<span class="sd">            information (if any).</span>

<span class="sd">        :return:</span>
<span class="sd">            (*bool*) -- Determines whether the given interaction is</span>
<span class="sd">            directed or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dir_col</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">dic_col</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">dir_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">dir_col</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">dir_col</span><span class="p">],</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="p">):</span>

            <span class="k">return</span> <span class="n">line</span><span class="p">[</span><span class="n">dir_col</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">dir_col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dir_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">dir_col</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dir_sep</span><span class="p">)</span> <span class="k">if</span> <span class="n">dir_sep</span> <span class="k">else</span> <span class="n">line</span><span class="p">[</span><span class="n">dir_col</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">dir_val</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_process_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract a value from a line describing an interaction.</span>

<span class="sd">        Args</span>
<span class="sd">            fmt (str, tuple, callable): The value, or a definition how to</span>
<span class="sd">                process it.</span>
<span class="sd">            line (list): The raw interaction record.</span>

<span class="sd">        Return</span>
<span class="sd">            (str): The extracted value.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">common</span><span class="o">.</span><span class="n">is_str</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">fmt</span>

        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">fmt</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">fmt</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>

            <span class="n">idx</span><span class="p">,</span> <span class="n">dct</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">{}</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

            <span class="n">idx</span><span class="p">,</span> <span class="n">dct</span> <span class="o">=</span> <span class="n">fmt</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">val</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_process_partner</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>

            <span class="n">partner</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">fmt</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>

            <span class="n">idx</span><span class="p">,</span> <span class="n">proc</span> <span class="o">=</span> <span class="n">fmt</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">line</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">line</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">partner</span> <span class="o">=</span> <span class="n">proc</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">partner</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="s1">&#39;strip&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">partner</span>


    <span class="k">def</span> <span class="nf">_map_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">lst</span><span class="p">,</span>
            <span class="n">single_list</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">expand_complexes</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps the names from a list of edges or items (molecules).</span>

<span class="sd">        :arg list lst:</span>
<span class="sd">            List of items or edge dictionaries whose names have to be</span>
<span class="sd">            mapped.</span>
<span class="sd">        :arg bool single_list:</span>
<span class="sd">            Optional, ``False`` by default. Determines whether the</span>
<span class="sd">            provided elements are items or edges. This is, either calls</span>
<span class="sd">            :py:meth:`pypath.main.PyPath.map_edge` or</span>
<span class="sd">            :py:meth:`pypath.main.PyPath.map_item` to map the item</span>
<span class="sd">            names.</span>
<span class="sd">        :arg bool expand_complexes:</span>
<span class="sd">            Expand complexes, i.e. create links between each member of</span>
<span class="sd">            the complex and the interacting partner.</span>

<span class="sd">        :return:</span>
<span class="sd">            (*list*) -- Copy of *lst* with their elements&#39; names mapped.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">list_mapped</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">single_list</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>

                <span class="n">list_mapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_item</span><span class="p">(</span>
                    <span class="n">item</span><span class="p">,</span>
                    <span class="n">expand_complexes</span> <span class="o">=</span> <span class="n">expand_complexes</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>

                <span class="n">list_mapped</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_edge</span><span class="p">(</span>
                    <span class="n">edge</span><span class="p">,</span>
                    <span class="n">expand_complexes</span> <span class="o">=</span> <span class="n">expand_complexes</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">list_mapped</span>


    <span class="k">def</span> <span class="nf">_map_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">expand_complexes</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translates the name in *item* representing a molecule. Default</span>
<span class="sd">        name types are defined in</span>
<span class="sd">        :py:attr:`pypath.main.PyPath.default_name_type` If the mapping</span>
<span class="sd">        is unsuccessful, the item will be added to</span>
<span class="sd">        :py:attr:`pypath.main.PyPath.unmapped` list.</span>

<span class="sd">        :arg dict item:</span>
<span class="sd">            Item whose name is to be mapped to a default name type.</span>
<span class="sd">        :arg bool expand_complexes:</span>
<span class="sd">            Expand complexes, i.e. create links between each member of</span>
<span class="sd">            the complex and the interacting partner.</span>

<span class="sd">        :return:</span>
<span class="sd">            (*list*) -- The default mapped name(s) [str] of *item*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: include</span>
        <span class="n">default_id</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;id_type&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_name_types</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]],</span>
            <span class="n">expand_complexes</span> <span class="o">=</span> <span class="n">expand_complexes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">unmapped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">default_id</span>


    <span class="k">def</span> <span class="nf">_map_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">expand_complexes</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translates the identifiers in *edge* representing an edge. Default</span>
<span class="sd">        name types are defined in</span>
<span class="sd">        :py:attr:`pypath.main.PyPath.default_name_type` If the mapping</span>
<span class="sd">        is unsuccessful, the item will be added to</span>
<span class="sd">        :py:attr:`pypath.main.PyPath.unmapped` list.</span>

<span class="sd">        :arg dict edge:</span>
<span class="sd">            Item whose name is to be mapped to a default name type.</span>
<span class="sd">        :arg bool expand_complexes:</span>
<span class="sd">            Expand complexes, i.e. create links between each member of</span>
<span class="sd">            the complex and the interacting partner.</span>

<span class="sd">        :return:</span>
<span class="sd">            (*list*) -- Contains the edge(s) [dict] with default mapped</span>
<span class="sd">            names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">edge_stack</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">defnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_name_types</span>
        <span class="n">def_name_type_a</span> <span class="o">=</span> <span class="n">defnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;entity_type_a&#39;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id_type_a&#39;</span><span class="p">])</span>
        <span class="n">def_name_type_b</span> <span class="o">=</span> <span class="n">defnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="s1">&#39;entity_type_b&#39;</span><span class="p">],</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id_type_b&#39;</span><span class="p">])</span>

        <span class="n">default_id_a</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id_a&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id_type_a&#39;</span><span class="p">],</span>
            <span class="n">def_name_type_a</span><span class="p">,</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;taxon_a&#39;</span><span class="p">],</span>
            <span class="n">expand_complexes</span> <span class="o">=</span> <span class="n">expand_complexes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">default_id_b</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_name</span><span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id_b&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;id_type_b&#39;</span><span class="p">],</span>
            <span class="n">def_name_type_b</span><span class="p">,</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;taxon_b&#39;</span><span class="p">],</span>
            <span class="n">expand_complexes</span> <span class="o">=</span> <span class="n">expand_complexes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># this is needed because the possibility ambigous mapping</span>
        <span class="c1"># and expansion of complexes</span>
        <span class="c1"># one name can be mapped to multiple ones</span>
        <span class="c1"># this multiplies the nodes and edges</span>
        <span class="c1"># in case of proteins this does not happen too often</span>
        <span class="k">for</span> <span class="n">id_a</span><span class="p">,</span> <span class="n">id_b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">default_id_a</span><span class="p">,</span> <span class="n">default_id_b</span><span class="p">):</span>

            <span class="n">this_edge</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="n">this_edge</span><span class="p">[</span><span class="s1">&#39;default_name_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_a</span>
            <span class="n">this_edge</span><span class="p">[</span><span class="s1">&#39;default_name_type_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">def_name_type_a</span>

            <span class="n">this_edge</span><span class="p">[</span><span class="s1">&#39;default_name_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_b</span>
            <span class="n">this_edge</span><span class="p">[</span><span class="s1">&#39;default_name_type_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">def_name_type_b</span>

            <span class="n">edge_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_edge</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">edge_stack</span>


    <span class="k">def</span> <span class="nf">_process_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">lnum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the extra (custom, resource specific) attributes from a</span>
<span class="sd">        line of the input based on the given specification (defined in the</span>
<span class="sd">        network input definition).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># extra_edge_attrs and extra_node_attrs are dicts</span>
            <span class="c1"># of additional parameters assigned to edges and nodes</span>
            <span class="c1"># respectively;</span>
            <span class="c1"># key is the name of the parameter, value is the col number,</span>
            <span class="c1"># or a tuple of col number and the separator,</span>
            <span class="c1"># if the column contains additional subfields e.g. (5, &quot;;&quot;)</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
                        <span class="n">field_value</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">](</span><span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">field_value</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_value</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">spec</span><span class="p">[</span><span class="n">col</span><span class="p">]]</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                    <span class="s1">&#39;Wrong column index (</span><span class="si">%s</span><span class="s1">) in extra attributes? &#39;</span>
                    <span class="s1">&#39;Line #</span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">lnum</span><span class="p">),</span>
                    <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">field_name</span> <span class="o">=</span> <span class="n">col</span>
            <span class="n">attrs</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_value</span>

        <span class="k">return</span> <span class="n">attrs</span>


    <span class="k">def</span> <span class="nf">_process_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_dict</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span> <span class="c1"># TODO</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">tax_dict</span>

        <span class="k">elif</span> <span class="s1">&#39;A&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span> <span class="ow">and</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">:</span>

            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_taxon</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">fields</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="s1">&#39;dict&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]])</span>

            <span class="k">elif</span> <span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">][</span><span class="n">fields</span><span class="p">[</span><span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]]]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">_match_taxon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_dict</span><span class="p">,</span> <span class="n">taxon</span><span class="p">,</span> <span class="n">only_default_organism</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="n">has_dict</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tax_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="n">has_include</span> <span class="o">=</span> <span class="n">has_dict</span> <span class="ow">and</span> <span class="s1">&#39;include&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span>
        <span class="n">has_exclude</span> <span class="o">=</span> <span class="n">has_dict</span> <span class="ow">and</span> <span class="s1">&#39;exclude&#39;</span> <span class="ow">in</span> <span class="n">tax_dict</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="n">taxon</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">NOT_ORGANISM_SPECIFIC</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">has_include</span> <span class="ow">and</span>
                <span class="n">taxon</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">has_exclude</span> <span class="ow">and</span>
                <span class="n">taxon</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tax_dict</span><span class="p">[</span><span class="s1">&#39;exclude&#39;</span><span class="p">]</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">has_include</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">has_exclude</span> <span class="ow">and</span>
                <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">only_default_organism</span> <span class="ow">or</span>
                    <span class="n">taxon</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>


    <span class="k">def</span> <span class="nf">_add_edge_list</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">edge_list</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">regulator</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">only_directions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds edges to the network from *edge_list* obtained from file or</span>
<span class="sd">        other input method. If none is passed, checks for such data in</span>
<span class="sd">        :py:attr:`pypath.network.Network.edge_list_mapped`.</span>

<span class="sd">        :arg str edge_list:</span>
<span class="sd">            Optional, ``False`` by default. The source name of the list</span>
<span class="sd">            of edges to be added. This must have been loaded previously</span>
<span class="sd">            (e.g.: with :py:meth:`pypath.main.PyPath.read_data_file`).</span>
<span class="sd">            If none is passed, loads the data directly from</span>
<span class="sd">            :py:attr:`pypath.main.PyPath.raw_data`.</span>
<span class="sd">        :arg bool regulator:</span>
<span class="sd">            Optional, ``False`` by default. If set to ``True``, non</span>
<span class="sd">            previously existing nodes, will not be added (and hence, the</span>
<span class="sd">            edges involved).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Adding preprocessed edge list to existing network.&#39;</span><span class="p">)</span>

        <span class="n">allow_loops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_loops</span><span class="p">(</span><span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">edge_list</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;edge_list_mapped&#39;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edge_list_mapped</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>

                <span class="n">edge_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_list_mapped</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;_add_edge_list(): No data, nothing to do.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">edge_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">:</span>

                <span class="n">edge_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="n">edge_list</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
                    <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">` looks like a source name, but no data &#39;</span>
                    <span class="s1">&#39;available under this name.&#39;</span> <span class="o">%</span> <span class="n">edge_list</span>
                <span class="p">)</span>

                <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_loops</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">prg</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">Progress</span><span class="p">(</span>
            <span class="n">iterable</span> <span class="o">=</span> <span class="n">edge_list</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Processing interactions&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">prg</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_update_edge</span><span class="p">(</span>
                <span class="n">e</span><span class="p">,</span>
                <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">,</span>
                <span class="n">only_directions</span> <span class="o">=</span> <span class="n">only_directions</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;New network resource added, current number &#39;</span>
            <span class="s1">&#39;of nodes: </span><span class="si">%u</span><span class="s1">, edges: </span><span class="si">%u</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_loops</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Loop edges discarded: </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_loops</span><span class="p">)</span>

        <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_filtered_loops&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">_add_update_edge</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">edge</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">only_directions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new interaction (edge) or updates the attributes of the edge</span>
<span class="sd">        if it already exists.</span>

<span class="sd">        :arg dict edge:</span>
<span class="sd">            A dictionary describing an edge (interaction) with the following</span>
<span class="sd">            items:</span>
<span class="sd">            :item str id_a:</span>
<span class="sd">                Name of the source node of the edge to be added/updated.</span>
<span class="sd">            :item str id_b:</span>
<span class="sd">                Name of the source node of the edge to be added/updated.</span>
<span class="sd">            :item set source:</span>
<span class="sd">                Or [list], contains the names [str] of the resources</span>
<span class="sd">                supporting that edge.</span>
<span class="sd">            :item pypath.evidence.Evidence evidence:</span>
<span class="sd">                A ``pypath.evidence.Evidence`` object.</span>
<span class="sd">            :item bool is_directed:</span>
<span class="sd">                Whether if the edge is directed or not.</span>
<span class="sd">            :item set refs:</span>
<span class="sd">                Or [list], contains the instances of the references</span>
<span class="sd">                :py:class:`pypath.refs.Reference` for that edge.</span>
<span class="sd">            :item bool stim:</span>
<span class="sd">                Whether the edge is stimulatory or not.</span>
<span class="sd">            :item bool inh:</span>
<span class="sd">                Whether the edge is inhibitory or note</span>
<span class="sd">            :item int taxon_a:</span>
<span class="sd">                NCBI Taxonomic identifier of the source molecule.</span>
<span class="sd">            :item int taxon_b:</span>
<span class="sd">                NCBI Taxonomic identifier of the target molecule.</span>
<span class="sd">            :item str typ:</span>
<span class="sd">                The type of interaction (e.g.: ``&#39;trascriptional&#39;``)</span>
<span class="sd">            :item dict extra_attrs:</span>
<span class="sd">                Optional, ``{}`` by default. Contains any extra attributes</span>
<span class="sd">                for the edge to be updated.</span>

<span class="sd">        :arg bool only_directions:</span>
<span class="sd">            Optional, ``False`` by default. If set to ``True`` and the</span>
<span class="sd">            edge is not in the network, it won&#39;t be created. If it already</span>
<span class="sd">            exists the attributes of the new edge will be added to the</span>
<span class="sd">            existing one.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="p">(</span>
            <span class="n">id_a</span><span class="p">,</span>
            <span class="n">id_b</span><span class="p">,</span>
            <span class="n">id_type_a</span><span class="p">,</span>
            <span class="n">id_type_b</span><span class="p">,</span>
            <span class="n">entity_type_a</span><span class="p">,</span>
            <span class="n">entity_type_b</span><span class="p">,</span>
            <span class="n">source</span><span class="p">,</span>
            <span class="n">evidences</span><span class="p">,</span>
            <span class="n">is_directed</span><span class="p">,</span>
            <span class="n">refs</span><span class="p">,</span>
            <span class="n">positive</span><span class="p">,</span>
            <span class="n">negative</span><span class="p">,</span>
            <span class="n">taxon_a</span><span class="p">,</span>
            <span class="n">taxon_b</span><span class="p">,</span>
            <span class="n">interaction_type</span><span class="p">,</span>
            <span class="n">extra_attrs</span><span class="p">,</span>
            <span class="n">extra_attrs_a</span><span class="p">,</span>
            <span class="n">extra_attrs_b</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;default_name_a&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;default_name_b&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;default_name_type_a&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;default_name_type_b&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;entity_type_a&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;entity_type_b&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;evidences&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;is_directed&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;references&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;positive&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;taxon_a&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;taxon_b&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;interaction_type&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;attrs_edge&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;attrs_node_a&#39;</span><span class="p">],</span>
            <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;attrs_node_b&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_loops</span>

        <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">refs_mod</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">pmid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pmid</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">}</span>

        <span class="n">entity_a</span> <span class="o">=</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">Entity</span><span class="p">(</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="n">id_a</span><span class="p">,</span>
            <span class="n">id_type</span> <span class="o">=</span> <span class="n">id_type_a</span><span class="p">,</span>
            <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type_a</span><span class="p">,</span>
            <span class="n">taxon</span> <span class="o">=</span> <span class="n">taxon_a</span><span class="p">,</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">extra_attrs_a</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">entity_b</span> <span class="o">=</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">Entity</span><span class="p">(</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="n">id_b</span><span class="p">,</span>
            <span class="n">id_type</span> <span class="o">=</span> <span class="n">id_type_b</span><span class="p">,</span>
            <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type_b</span><span class="p">,</span>
            <span class="n">taxon</span> <span class="o">=</span> <span class="n">taxon_b</span><span class="p">,</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">extra_attrs_b</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">interaction</span> <span class="o">=</span> <span class="n">interaction_mod</span><span class="o">.</span><span class="n">Interaction</span><span class="p">(</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">entity_a</span><span class="p">,</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">entity_b</span><span class="p">,</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">extra_attrs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_loops</span> <span class="ow">and</span> <span class="n">interaction</span><span class="o">.</span><span class="n">is_loop</span><span class="p">():</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_loops</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">is_directed</span><span class="p">:</span>

            <span class="n">interaction</span><span class="o">.</span><span class="n">add_evidence</span><span class="p">(</span>
                <span class="n">evidence</span> <span class="o">=</span> <span class="n">evidences</span><span class="p">,</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">interaction</span><span class="o">.</span><span class="n">add_evidence</span><span class="p">(</span>
                <span class="n">evidence</span> <span class="o">=</span> <span class="n">evidences</span><span class="p">,</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;undirected&#39;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># setting signs:</span>
        <span class="k">if</span> <span class="n">positive</span><span class="p">:</span>

            <span class="n">interaction</span><span class="o">.</span><span class="n">add_evidence</span><span class="p">(</span>
                <span class="n">evidence</span> <span class="o">=</span> <span class="n">evidences</span><span class="p">,</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">),</span>
                <span class="n">effect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>

            <span class="n">interaction</span><span class="o">.</span><span class="n">add_evidence</span><span class="p">(</span>
                <span class="n">evidence</span> <span class="o">=</span> <span class="n">evidences</span><span class="p">,</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">),</span>
                <span class="n">effect</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">is_directed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">positive</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">negative</span><span class="p">:</span>

            <span class="n">interaction</span><span class="o">.</span><span class="n">add_evidence</span><span class="p">(</span>
                <span class="n">evidence</span> <span class="o">=</span> <span class="n">evidences</span><span class="p">,</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">),</span>
                <span class="n">effect</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span>
            <span class="n">interaction</span><span class="p">,</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">extra_attrs</span><span class="p">,</span>
            <span class="n">only_directions</span> <span class="o">=</span> <span class="n">only_directions</span><span class="p">,</span>
        <span class="p">)</span>


<div class="viewcode-block" id="Network.organisms_check"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.organisms_check">[docs]</a>    <span class="k">def</span> <span class="nf">organisms_check</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">organisms</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">remove_mismatches</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">remove_nonspecific</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scans the network for one or more organisms and removes the nodes</span>
<span class="sd">        and interactions which belong to any other organism.</span>

<span class="sd">        :arg int,set,NoneType organisms:</span>
<span class="sd">            One or more NCBI Taxonomy IDs. If ``None`` the value in</span>
<span class="sd">            :py:attr:`ncbi_tax_id` will be used. If that&#39;s too is ``None``</span>
<span class="sd">            then only the entities with discrepancy between their stated</span>
<span class="sd">            organism and their identifier.</span>
<span class="sd">        :arg bool remove_mismatches:</span>
<span class="sd">            Remove the entities where their ``identifier`` can not be found</span>
<span class="sd">            in the reference list from the database for their ``taxon``.</span>
<span class="sd">        :arg bool remove_nonspecific:</span>
<span class="sd">            Remove the entities with taxonomy ID zero, which is used to</span>
<span class="sd">            represent the non taxon specific entities such as metabolites</span>
<span class="sd">            or drug compounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Checking organisms. </span><span class="si">%u</span><span class="s1"> nodes and </span><span class="si">%u</span><span class="s1"> interactions before.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">organisms</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">organisms</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">)</span>

        <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">organisms</span> <span class="ow">and</span>
                <span class="n">node</span><span class="o">.</span><span class="n">taxon</span> <span class="o">!=</span> <span class="n">constants</span><span class="o">.</span><span class="n">NOT_ORGANISM_SPECIFIC</span> <span class="ow">and</span>
                <span class="n">node</span><span class="o">.</span><span class="n">taxon</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">organisms</span>
            <span class="p">):</span>

                <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">remove_mismatches</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">entity_type</span> <span class="ow">in</span> <span class="p">{</span>
                        <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;lncrna&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;drug&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;small_molecule&#39;</span>
                    <span class="p">}</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">reflists</span><span class="o">.</span><span class="n">check</span><span class="p">(</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span>
                        <span class="n">id_type</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">id_type</span><span class="p">,</span>
                        <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">taxon</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">remove_nonspecific</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">taxon</span>
                <span class="p">)</span>
            <span class="p">):</span>

                <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Finished checking organisms. &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> nodes have been removed, &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> nodes and </span><span class="si">%u</span><span class="s1"> interactions remained.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Network.get_organisms"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.get_organisms">[docs]</a>    <span class="k">def</span> <span class="nf">get_organisms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the set of all NCBI Taxonomy IDs occurring in the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">n</span><span class="o">.</span><span class="n">taxon</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vcount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ecount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">)</span>


<div class="viewcode-block" id="Network.make_df"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.make_df">[docs]</a>    <span class="k">def</span> <span class="nf">make_df</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">records</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">by_source</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">with_references</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a ``pandas.DataFrame`` from the interactions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Creating interactions data frame.&#39;</span><span class="p">)</span>

        <span class="n">by_source</span> <span class="o">=</span> <span class="n">by_source</span> <span class="k">if</span> <span class="n">by_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_by_source</span>
        <span class="n">with_references</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">with_references</span>
                <span class="k">if</span> <span class="n">with_references</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_with_references</span>
        <span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_columns</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_dtype</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span><span class="p">:</span>

            <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id_a&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
                <span class="s1">&#39;id_b&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
                <span class="s1">&#39;type_a&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
                <span class="s1">&#39;type_b&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
                <span class="s1">&#39;effect&#39;</span><span class="p">:</span> <span class="s1">&#39;int8&#39;</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dmodel&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span> <span class="k">if</span> <span class="n">by_source</span> <span class="k">else</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
                <span class="s1">&#39;sources&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span> <span class="k">if</span> <span class="n">by_source</span> <span class="k">else</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
                <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span> <span class="k">if</span> <span class="n">with_references</span> <span class="k">else</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">records</span><span class="p">:</span>

            <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_df_records</span><span class="p">(</span>
                <span class="n">by_source</span> <span class="o">=</span> <span class="n">by_source</span><span class="p">,</span>
                <span class="n">with_references</span> <span class="o">=</span> <span class="n">with_references</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>

            <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">columns</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;_fields&#39;</span><span class="p">):</span>

            <span class="n">columns</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">records</span><span class="p">,</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1">### why?</span>
        <span class="k">if</span> <span class="n">dtype</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Interaction data frame ready. &#39;</span>
            <span class="s1">&#39;Memory usage: </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">common</span><span class="o">.</span><span class="n">df_memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;df&#39;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">make_df</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>


    <span class="k">def</span> <span class="nf">filtered</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">entity_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_model</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">interaction_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">only_directed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">only_undirected</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">only_signed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">only_proteins</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">source_entities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">target_entities</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">swap_undirected</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_df</span><span class="p">(</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_df</span><span class="p">(),</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span><span class="p">,</span>
            <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="n">data_model</span> <span class="o">=</span> <span class="n">data_model</span><span class="p">,</span>
            <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">interaction_type</span><span class="p">,</span>
            <span class="n">only_directed</span> <span class="o">=</span> <span class="n">only_directed</span><span class="p">,</span>
            <span class="n">only_undirected</span> <span class="o">=</span> <span class="n">only_undirected</span><span class="p">,</span>
            <span class="n">only_signed</span> <span class="o">=</span> <span class="n">only_signed</span><span class="p">,</span>
            <span class="n">only_proteins</span> <span class="o">=</span> <span class="n">only_proteins</span><span class="p">,</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="n">effect</span><span class="p">,</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="n">entities</span><span class="p">,</span>
            <span class="n">source_entities</span> <span class="o">=</span> <span class="n">source_entities</span><span class="p">,</span>
            <span class="n">target_entities</span> <span class="o">=</span> <span class="n">target_entities</span><span class="p">,</span>
            <span class="n">swap_undirected</span> <span class="o">=</span> <span class="n">swap_undirected</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">filter_df</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">core_common</span><span class="o">.</span><span class="n">filter_network_df</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">generate_df_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_source</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_references</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">ia</span><span class="o">.</span><span class="n">generate_df_records</span><span class="p">(</span>
                <span class="n">by_source</span> <span class="o">=</span> <span class="n">by_source</span><span class="p">,</span>
                <span class="n">with_references</span> <span class="o">=</span> <span class="n">with_references</span><span class="p">,</span>
            <span class="p">):</span>

                <span class="k">yield</span> <span class="n">rec</span>


<div class="viewcode-block" id="Network.from_igraph"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.from_igraph">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_igraph</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance from an ``igraph.Graph`` based</span>
<span class="sd">        ``pypath.main.PyPath`` object.</span>

<span class="sd">        :arg pypath.main.PyPath pa:</span>
<span class="sd">            A ``pypath.main.PyPath`` object with network data loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">pa</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;attrs&#39;</span><span class="p">]:</span>

            <span class="n">obj</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span></div>


<div class="viewcode-block" id="Network.add_interaction"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.add_interaction">[docs]</a>    <span class="k">def</span> <span class="nf">add_interaction</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">interaction</span><span class="p">,</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">only_directions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a ready ``pypath.interaction.Interaction`` object to the network.</span>
<span class="sd">        If an interaction between the two endpoints already exists, the</span>
<span class="sd">        interactions will be merged: this stands for the directions, signs,</span>
<span class="sd">        evidences and other attributes.</span>

<span class="sd">        :arg interaction.Interaction interaction:</span>
<span class="sd">            A ``pypath.interaction.Interaction`` object.</span>
<span class="sd">        :arg NoneType,dict attrs:</span>
<span class="sd">            Optional, a dictionary of extra (usually resource specific)</span>
<span class="sd">            attributes.</span>
<span class="sd">        :arg bool only_directions:</span>
<span class="sd">            If the interaction between the two endpoints does not exist it</span>
<span class="sd">            won&#39;t be added to the network. Otherwise all attributes</span>
<span class="sd">            (direction, effect sign, evidences, etc) will be merged to the</span>
<span class="sd">            existing interaction. Apart from the endpoints also the</span>
<span class="sd">            ``interaction_type`` of the existing interaction has to match the</span>
<span class="sd">            interaction added here.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">interaction</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">interaction</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">only_directions</span><span class="p">:</span>

                <span class="k">return</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">only_directions</span><span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_interaction_types</span><span class="p">()</span> <span class="o">&amp;</span>
                    <span class="n">interaction</span><span class="o">.</span><span class="n">get_interaction_types</span><span class="p">()</span>
                <span class="p">):</span>

                    <span class="k">for</span> <span class="n">itype_to_remove</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="n">interaction</span><span class="o">.</span><span class="n">get_interaction_types</span><span class="p">()</span> <span class="o">-</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_interaction_types</span><span class="p">()</span>
                    <span class="p">):</span>

                        <span class="n">interaction</span><span class="o">.</span><span class="n">unset_interaction_type</span><span class="p">(</span><span class="n">itype_to_remove</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">interaction</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update_attrs</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">interaction</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">only_directions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">interaction</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">only_directions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">interaction</span><span class="o">.</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">interaction</span><span class="o">.</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.add_node"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">attrs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a molecular entity to the py:attr:``nodes`` and</span>
<span class="sd">        py:attr:``nodes_by_label`` dictionaries.</span>

<span class="sd">        :arg entity.Entity entity:</span>
<span class="sd">            An object representing a molecular entity.</span>
<span class="sd">        :arg NoneType,dict attrs:</span>
<span class="sd">            Optional extra attributes to be assigned to the entity.</span>
<span class="sd">        :arg bool add:</span>
<span class="sd">            Whether to add a new molecular entity to the network if it does</span>
<span class="sd">            not exist yet. If ``False`` will only update attributes for</span>
<span class="sd">            existing entities otherwise will do nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>

            <span class="n">entity</span><span class="o">.</span><span class="n">update_attrs</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span> <span class="o">+=</span> <span class="n">entity</span>

        <span class="k">elif</span> <span class="n">add</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="n">entity</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span></div>


<div class="viewcode-block" id="Network.remove_node"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.remove_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a node with all its interactions.</span>
<span class="sd">        If the removal of the interactions leaves any of the partner nodes</span>
<span class="sd">        without interactions it will be removed too.</span>

<span class="sd">        :arg str,Entity entity:</span>
<span class="sd">            A molecular entity identifier, label or ``Entity`` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="p">:</span>

            <span class="k">return</span>

        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">:</span>

            <span class="n">partners</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">remove_interaction</span><span class="p">(</span><span class="o">*</span><span class="n">i_key</span><span class="p">)</span>

            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.remove_interaction"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.remove_interaction">[docs]</a>    <span class="k">def</span> <span class="nf">remove_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the interaction between two nodes if exists.</span>

<span class="sd">        :arg str,Entity entity_a,entity_b:</span>
<span class="sd">            A pair of molecular entity identifiers, labels or ``Entity``</span>
<span class="sd">            objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">entity_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="n">entity_a</span><span class="p">)</span>
        <span class="n">entity_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="n">entity_b</span><span class="p">)</span>

        <span class="n">key_ab</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">)</span>
        <span class="n">key_ba</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_b</span><span class="p">,</span> <span class="n">entity_a</span><span class="p">)</span>

        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key_ab</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key_ba</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">key_ab</span><span class="p">,</span> <span class="n">key_ba</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">entity_a</span><span class="p">]</span> <span class="o">-=</span> <span class="n">keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">entity_b</span><span class="p">]</span> <span class="o">-=</span> <span class="n">keys</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">entity_a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">entity_a</span><span class="p">]</span>
        <span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">entity_a</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">entity_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">entity_b</span><span class="p">]</span>
        <span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">entity_b</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.remove_zero_degree"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.remove_zero_degree">[docs]</a>    <span class="k">def</span> <span class="nf">remove_zero_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all nodes with no interaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Removing zero degree nodes. &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> nodes and </span><span class="si">%u</span><span class="s1"> interactions before.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">interactions</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">interactions</span><span class="p">:</span>

                <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Finished removing zero degree nodes. &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> nodes have been removed, &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> nodes and </span><span class="si">%u</span><span class="s1"> interactions remained.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Network.remove_loops"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.remove_loops">[docs]</a>    <span class="k">def</span> <span class="nf">remove_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the loop interactions from the network i.e. the ones with</span>
<span class="sd">        their two endpoints being the same entity.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Removing loop edges. Number of edges before: </span><span class="si">%u</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">ia</span><span class="o">.</span><span class="n">is_loop</span><span class="p">():</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">remove_interaction</span><span class="p">(</span><span class="n">ia</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">ia</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Removed loop edges. Number of edges after: </span><span class="si">%u</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a set of all resources.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ia</span><span class="o">.</span><span class="n">get_resources</span><span class="p">()</span> <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resource_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a set of all resource names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">ia</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">()</span> <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>


<div class="viewcode-block" id="Network.entities_by_resource"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.entities_by_resource">[docs]</a>    <span class="k">def</span> <span class="nf">entities_by_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dict of sets with resources as keys and sets of entity IDs</span>
<span class="sd">        as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">resource</span><span class="p">,</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span>
                            <span class="p">[</span>
                                <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span>
                                <span class="k">for</span> <span class="n">resources</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sources</span>
                            <span class="p">]</span>
                        <span class="p">][[</span><span class="s1">&#39;id_a&#39;</span><span class="p">,</span> <span class="s1">&#39;id_b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Network.entity_by_id"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.entity_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">entity_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a ``pypath.entity.Entity`` object representing a molecular</span>
<span class="sd">        entity by looking it up by its identifier. If the molecule does not</span>
<span class="sd">        present in the current network ``None`` will be returned.</span>

<span class="sd">        :arg str identifier:</span>
<span class="sd">            The identifier of a molecular entity. Unless it&#39;s been set</span>
<span class="sd">            otherwise for genes/proteins it is the UniProt ID.</span>
<span class="sd">            E.g. ``&#39;P00533&#39;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span></div>


<div class="viewcode-block" id="Network.entity_by_label"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.entity_by_label">[docs]</a>    <span class="k">def</span> <span class="nf">entity_by_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a ``pypath.entity.Entity`` object representing a molecular</span>
<span class="sd">        entity by looking it up by its label. If the molecule does not</span>
<span class="sd">        present in the current network ``None`` will be returned.</span>

<span class="sd">        :arg str label:</span>
<span class="sd">            The label of a molecular entity. Unless it&#39;s been set otherwise</span>
<span class="sd">            for genes/proteins it is the Gene Symbol. E.g. ``&#39;EGFR&#39;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span></div>


<div class="viewcode-block" id="Network.interaction"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.interaction">[docs]</a>    <span class="k">def</span> <span class="nf">interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the interaction `a --&gt; b` if it exists in the network,</span>
<span class="sd">        otherwise `b --&gt; a`. If no interaction exist between `a` and `b`</span>
<span class="sd">        returns `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">entity_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">entity_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">key_ab</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">)</span>
        <span class="n">key_ba</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_b</span><span class="p">,</span> <span class="n">entity_a</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_ab</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key_ab</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">key_ba</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key_ba</span><span class="p">]</span></div>


<div class="viewcode-block" id="Network.random_interaction"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.random_interaction">[docs]</a>    <span class="k">def</span> <span class="nf">random_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Picks a random interaction from the network.</span>

<span class="sd">        Returns</span>
<span class="sd">            An Interaction object, or None if the network is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interactions</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kwargs</span> <span class="k">else</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">keys</span><span class="p">):</span>

            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">key</span><span class="p">:</span>

            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">identifier</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="k">else</span> <span class="kc">None</span></div>


    <span class="k">def</span> <span class="nf">_get_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_a</span><span class="p">,</span> <span class="n">id_b</span><span class="p">,</span> <span class="n">name_type</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">):</span>

        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;entity_by_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name_type</span>

        <span class="n">entity_a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="n">id_a</span><span class="p">)</span>
        <span class="n">entity_b</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="n">id_b</span><span class="p">)</span>

        <span class="n">a_b</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_a</span><span class="p">,</span> <span class="n">entity_b</span><span class="p">)</span>
        <span class="n">b_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">entity_b</span><span class="p">,</span> <span class="n">entity_a</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">a_b</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">b_a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">b_a</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>

            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_by_id</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_by_label</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">entity</span>


<div class="viewcode-block" id="Network.interaction_by_id"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.interaction_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">interaction_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_a</span><span class="p">,</span> <span class="n">id_b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a ``pypath.interaction.Interaction`` object by looking it up</span>
<span class="sd">        based on a pair of identifiers. If the interaction does not exist</span>
<span class="sd">        in the network ``None`` will be returned.</span>

<span class="sd">        :arg str id_a:</span>
<span class="sd">            The identifier of one of the partners in the interaction. Unless</span>
<span class="sd">            it&#39;s been set otherwise for genes/proteins it is the UniProt ID.</span>
<span class="sd">            E.g. ``&#39;P00533&#39;``.</span>
<span class="sd">        :arg str id_b:</span>
<span class="sd">            The other partner, similarly to ``id_a``. The order of the</span>
<span class="sd">            partners does not matter here.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_interaction</span><span class="p">(</span><span class="n">id_a</span><span class="p">,</span> <span class="n">id_b</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.interaction_by_label"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.interaction_by_label">[docs]</a>    <span class="k">def</span> <span class="nf">interaction_by_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_a</span><span class="p">,</span> <span class="n">label_b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a ``pypath.interaction.Interaction`` object by looking it up</span>
<span class="sd">        based on a pair of labels. If the interaction does not exist</span>
<span class="sd">        in the network ``None`` will be returned.</span>

<span class="sd">        :arg str label_a:</span>
<span class="sd">            The label of one of the partners in the interaction. Unless</span>
<span class="sd">            it&#39;s been set otherwise for genes/proteins it is the Gene Symbol.</span>
<span class="sd">            E.g. ``&#39;EGFR&#39;``.</span>
<span class="sd">        :arg str label_b:</span>
<span class="sd">            The other partner, similarly to ``label_a``. The order of the</span>
<span class="sd">            partners does not matter here.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_interaction</span><span class="p">(</span><span class="n">label_a</span><span class="p">,</span> <span class="n">label_b</span><span class="p">,</span> <span class="n">name_type</span> <span class="o">=</span> <span class="s1">&#39;label&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.to_igraph"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.to_igraph">[docs]</a>    <span class="k">def</span> <span class="nf">to_igraph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the network to the legacy ``igraph.Graph`` based ``PyPath``</span>
<span class="sd">        object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s1">&#39;&lt;Network: </span><span class="si">%u</span><span class="s1"> nodes, </span><span class="si">%u</span><span class="s1"> interactions&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span><span class="p">,</span>
        <span class="p">)</span>


<div class="viewcode-block" id="Network.save_to_pickle"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.save_to_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the network to a pickle file.</span>

<span class="sd">        :arg str pickle_file:</span>
<span class="sd">            Path to the pickle file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Saving to pickle `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">pickle_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">fp</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_interactions_by_nodes</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Saved to pickle `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">pickle_file</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_update_interactions_by_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>


<div class="viewcode-block" id="Network.load_from_pickle"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.load_from_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the network to a pickle file.</span>

<span class="sd">        :arg str pickle_file:</span>
<span class="sd">            Path to the pickle file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Loading from pickle `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">pickle_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_by_label</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_interactions_by_nodes</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Loaded from pickle `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">pickle_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="Network.from_pickle"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.from_pickle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pickle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pickle_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new ``Network`` object by loading it from a pickle</span>
<span class="sd">        file. Returns a ``Network`` object.</span>

<span class="sd">        Args</span>
<span class="sd">            pickle_file:</span>
<span class="sd">                Path to a pickle file.</span>
<span class="sd">            kwargs:</span>
<span class="sd">                Passed to ``Network.__init__``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">pickle_file</span> <span class="o">=</span> <span class="n">pickle_file</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span></div>


<div class="viewcode-block" id="Network.extra_directions"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.extra_directions">[docs]</a>    <span class="k">def</span> <span class="nf">extra_directions</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="s1">&#39;extra_directions&#39;</span><span class="p">,</span>
            <span class="n">use_laudanna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">use_string</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="s1">&#39;directionextra&#39;</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds additional direction &amp; effect information from resources having</span>
<span class="sd">        no literature curated references, but giving sufficient evidence</span>
<span class="sd">        about the directionality for interactions already supported by</span>
<span class="sd">        literature evidences from other sources.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">resources</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">network_resources</span><span class="p">,</span> <span class="n">resources</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">basestring</span><span class="p">)</span> <span class="k">else</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">resources</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">use_laudanna</span><span class="p">:</span>

            <span class="n">resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">network_resources</span><span class="o">.</span><span class="n">pathway_bad</span><span class="p">[</span><span class="s1">&#39;laudanna_effects&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">network_resources</span><span class="o">.</span><span class="n">pathway_bad</span><span class="p">[</span><span class="s1">&#39;laudanna_directions&#39;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">use_string</span><span class="p">:</span>

            <span class="k">pass</span>

        <span class="n">resources</span> <span class="o">=</span> <span class="n">resource_mod</span><span class="o">.</span><span class="n">NetworkDataset</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">,</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span><span class="p">,</span> <span class="n">only_directions</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">omnipath_resources</span><span class="p">(</span>
            <span class="n">omnipath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">kinase_substrate_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ligand_receptor_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">pathway_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">old_omnipath_resources</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">network_resoruces</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">NetworkResource</span><span class="p">]:</span>


        <span class="k">def</span> <span class="nf">reference_constraints</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="n">data_model</span><span class="p">,</span> <span class="n">relax</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">resources</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">resources</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span>
                <span class="n">resources</span>
            <span class="p">)</span>

            <span class="n">resources</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">resources</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">data_model</span> <span class="o">==</span> <span class="n">data_model</span><span class="p">:</span>

                    <span class="n">res</span><span class="o">.</span><span class="n">networkinput</span><span class="o">.</span><span class="n">must_have_references</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">relax</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>


        <span class="n">omnipath</span> <span class="o">=</span> <span class="n">omnipath</span> <span class="ow">or</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">network_resources</span><span class="o">.</span><span class="n">omnipath</span><span class="p">)</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">to_set</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">old_omnipath_resources</span><span class="p">:</span>

            <span class="n">interaction_resources</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">network_resources</span><span class="o">.</span><span class="n">interaction</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">omnipath</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">omnipath</span><span class="p">)</span>
            <span class="n">omnipath</span><span class="p">[</span><span class="s1">&#39;biogrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_resources</span><span class="p">[</span><span class="s1">&#39;biogrid&#39;</span><span class="p">]</span>
            <span class="n">omnipath</span><span class="p">[</span><span class="s1">&#39;alz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_resources</span><span class="p">[</span><span class="s1">&#39;alz&#39;</span><span class="p">]</span>
            <span class="n">omnipath</span><span class="p">[</span><span class="s1">&#39;netpath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_resources</span><span class="p">[</span><span class="s1">&#39;netpath&#39;</span><span class="p">]</span>
            <span class="n">exclude</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;IntAct&#39;</span><span class="p">,</span> <span class="s1">&#39;HPRD&#39;</span><span class="p">})</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">omnipath</span><span class="p">[</span><span class="s1">&#39;huri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                <span class="n">network_resources</span><span class="o">.</span><span class="n">interaction_misc</span><span class="p">[</span><span class="s1">&#39;huri&#39;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">omnipath</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">omnipath</span><span class="o">.</span><span class="n">without</span><span class="p">(</span><span class="n">exclude</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">data_model</span><span class="p">,</span> <span class="n">enabled</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;pathwayextra&#39;</span><span class="p">,</span> <span class="s1">&#39;activity_flow&#39;</span><span class="p">,</span> <span class="n">pathway_extra</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;ligrecextra&#39;</span><span class="p">,</span> <span class="s1">&#39;ligand_receptor&#39;</span><span class="p">,</span> <span class="n">ligand_receptor_extra</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;kinaseextra&#39;</span><span class="p">,</span> <span class="s1">&#39;enzyme_substrate&#39;</span><span class="p">,</span> <span class="n">kinase_substrate_extra</span><span class="p">),</span>
        <span class="p">):</span>

            <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>

                <span class="n">extra</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">resource_mod</span><span class="o">.</span><span class="n">NetworkDataset</span><span class="p">(</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">,</span>
                        <span class="n">resources</span> <span class="o">=</span> <span class="n">reference_constraints</span><span class="p">(</span>
                            <span class="n">omnipath</span><span class="p">,</span>
                            <span class="n">data_model</span><span class="p">,</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">omnipath</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">omnipath</span>


    <span class="k">def</span> <span class="nf">load_omnipath</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">omnipath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">kinase_substrate_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ligand_receptor_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">pathway_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">extra_directions</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">remove_htp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">htp_threshold</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">keep_directed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">remove_undirected</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">min_refs_undirected</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">min_resources_undirected</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">old_omnipath_resources</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">pickle_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Loading the `OmniPath` network.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pickle_file</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pickle_file</span> <span class="o">=</span> <span class="n">pickle_file</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">omnipath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">omnipath_resources</span><span class="p">(</span>
            <span class="n">omnipath</span> <span class="o">=</span> <span class="n">omnipath</span><span class="p">,</span>
            <span class="n">kinase_substrate_extra</span> <span class="o">=</span> <span class="n">kinase_substrate_extra</span><span class="p">,</span>
            <span class="n">ligand_receptor_extra</span> <span class="o">=</span> <span class="n">ligand_receptor_extra</span><span class="p">,</span>
            <span class="n">pathway_extra</span> <span class="o">=</span> <span class="n">pathway_extra</span><span class="p">,</span>
            <span class="n">old_omnipath_resources</span> <span class="o">=</span> <span class="n">old_omnipath_resources</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">omnipath</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">,</span> <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">enabled</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;pathwayextra&#39;</span><span class="p">,</span> <span class="s1">&#39;activity flow&#39;</span><span class="p">,</span> <span class="n">pathway_extra</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;ligrecextra&#39;</span><span class="p">,</span> <span class="s1">&#39;ligand-receptor&#39;</span><span class="p">,</span> <span class="n">ligand_receptor_extra</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;kinaseextra&#39;</span><span class="p">,</span> <span class="s1">&#39;enzyme-PTM&#39;</span><span class="p">,</span> <span class="n">kinase_substrate_extra</span><span class="p">),</span>
        <span class="p">):</span>

            <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading extra </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1"> interactions.&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">network_resources</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span>
                    <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">extra_directions</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">extra_directions</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">remove_htp</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_htp</span><span class="p">(</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">htp_threshold</span><span class="p">,</span>
                <span class="n">keep_directed</span> <span class="o">=</span> <span class="n">keep_directed</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">remove_undirected</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_undirected</span><span class="p">(</span>
                <span class="n">min_refs</span> <span class="o">=</span> <span class="n">min_refs_undirected</span><span class="p">,</span>
                <span class="n">min_resources</span> <span class="o">=</span> <span class="n">min_resources_undirected</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Finished loading the `OmniPath` network.&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">remove_htp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">keep_directed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Removing high-throughput interactions above threshold </span><span class="si">%u</span><span class="s1">&#39;</span>
            <span class="s1">&#39; interactions per reference. Directed interactions </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">threshold</span><span class="p">,</span>
                <span class="s1">&#39;will be kept&#39;</span> <span class="k">if</span> <span class="n">keep_directed</span> <span class="k">else</span> <span class="s1">&#39;also will be removed&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">to_remove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">htp_interactions</span><span class="p">(</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="n">ignore_directed</span> <span class="o">=</span> <span class="n">keep_directed</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ecount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span>
        <span class="n">vcount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_interaction</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Interactions with only high-throughput references &#39;</span>
            <span class="s1">&#39;have been removed. </span><span class="si">%u</span><span class="s1"> interactions removed. &#39;</span>
            <span class="s1">&#39;Number of edges decreased from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">, &#39;</span>
            <span class="s1">&#39;number of nodes from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">),</span>
                <span class="n">ecount_before</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span><span class="p">,</span>
                <span class="n">vcount_before</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>


<div class="viewcode-block" id="Network.htp_references"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.htp_references">[docs]</a>    <span class="k">def</span> <span class="nf">htp_references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">50</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects the high-throughput references i.e. the ones cited at a</span>
<span class="sd">        higher number of interactions than ``threshold``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">interactions_per_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numof_interactions_per_reference</span><span class="p">()</span>

        <span class="n">htp_refs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ref</span>
            <span class="k">for</span> <span class="n">ref</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">interactions_per_reference</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="n">threshold</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;High-throughput references collected: </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">htp_refs</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">htp_refs</span></div>


<div class="viewcode-block" id="Network.htp_interactions"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.htp_interactions">[docs]</a>    <span class="k">def</span> <span class="nf">htp_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">ignore_directed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects the interactions only from high-throughput studies.</span>

<span class="sd">        :returns:</span>
<span class="sd">            Set of interaction keys (tuples of entities).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">htp_refs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">htp_references</span><span class="p">(</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span><span class="p">)</span>

        <span class="n">htp_int</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">):</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">ignore_directed</span> <span class="ow">or</span>
                    <span class="ow">not</span> <span class="n">ia</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span>
                <span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">ia</span><span class="o">.</span><span class="n">get_references</span><span class="p">()</span> <span class="o">-</span> <span class="n">htp_refs</span>
            <span class="p">):</span>

                <span class="n">htp_int</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;High-throughput interactions collected: </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">htp_int</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">htp_int</span></div>


    <span class="k">def</span> <span class="nf">remove_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_refs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">min_resources</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Removing undirected interactions</span><span class="si">%s%s%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="s1">&#39; with less than </span><span class="si">%u</span><span class="s1"> references&#39;</span> <span class="o">%</span> <span class="n">min_refs</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">min_refs</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39; and&#39;</span> <span class="k">if</span> <span class="n">min_refs</span> <span class="ow">and</span> <span class="n">min_resources</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s1">&#39; with less than </span><span class="si">%u</span><span class="s1"> resources &#39;</span> <span class="o">%</span> <span class="n">min_resources</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">ecount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span>
        <span class="n">vcount_before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span>

        <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">):</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">ia</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span> <span class="ow">and</span>
                <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">min_refs</span> <span class="ow">or</span>
                    <span class="n">ia</span><span class="o">.</span><span class="n">count_references</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">min_refs</span>
                <span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">min_resources</span> <span class="ow">or</span>
                    <span class="n">ia</span><span class="o">.</span><span class="n">count_resource_names</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">min_resources</span>
                <span class="p">)</span>
            <span class="p">):</span>

                <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">remove_interaction</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Undirected interactions </span><span class="si">%s</span><span class="s1"> have been removed. &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> interactions removed. Number of edges &#39;</span>
            <span class="s1">&#39;decreased from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">, number of vertices &#39;</span>
            <span class="s1">&#39;from </span><span class="si">%u</span><span class="s1"> to </span><span class="si">%u</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="s1">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">min_refs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span>
                <span class="s1">&#39;with less than </span><span class="si">%u</span><span class="s1"> references&#39;</span> <span class="o">%</span> <span class="n">min_refs</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">),</span>
                <span class="n">ecount_before</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ecount</span><span class="p">,</span>
                <span class="n">vcount_before</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcount</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>


<div class="viewcode-block" id="Network.numof_interactions_per_reference"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.numof_interactions_per_reference">[docs]</a>    <span class="k">def</span> <span class="nf">numof_interactions_per_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of interactions for each literature reference.</span>
<span class="sd">        Returns a ``collections.Counter`` object (similar to ``dict``).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span>
                    <span class="n">ia</span><span class="o">.</span><span class="n">get_references</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Network.interactions_by_reference"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.interactions_by_reference">[docs]</a>    <span class="k">def</span> <span class="nf">interactions_by_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a ``dict`` with literature references as keys and interactions</span>
<span class="sd">        described by each reference as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">interactions_by_reference</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i_key</span><span class="p">,</span> <span class="n">ia</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">ia</span><span class="o">.</span><span class="n">get_references</span><span class="p">():</span>

                <span class="n">interactions_by_reference</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">interactions_by_reference</span><span class="p">)</span></div>

    <span class="c1">#</span>
    <span class="c1"># Methods for loading specific datasets or initializing the object</span>
    <span class="c1"># with loading datasets</span>
    <span class="c1">#</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">omnipath</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">omnipath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">kinase_substrate_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ligand_receptor_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">pathway_extra</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">extra_directions</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">remove_htp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">htp_threshold</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">keep_directed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">min_refs_undirected</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">old_omnipath_resources</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>

        <span class="n">make_df</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;make_df&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">load_omnipath</span><span class="p">(</span>
            <span class="n">omnipath</span> <span class="o">=</span> <span class="n">omnipath</span><span class="p">,</span>
            <span class="n">kinase_substrate_extra</span> <span class="o">=</span> <span class="n">kinase_substrate_extra</span><span class="p">,</span>
            <span class="n">ligand_receptor_extra</span> <span class="o">=</span> <span class="n">ligand_receptor_extra</span><span class="p">,</span>
            <span class="n">pathway_extra</span> <span class="o">=</span> <span class="n">pathway_extra</span><span class="p">,</span>
            <span class="n">extra_directions</span> <span class="o">=</span> <span class="n">extra_directions</span><span class="p">,</span>
            <span class="n">remove_htp</span> <span class="o">=</span> <span class="n">remove_htp</span><span class="p">,</span>
            <span class="n">htp_threshold</span> <span class="o">=</span> <span class="n">htp_threshold</span><span class="p">,</span>
            <span class="n">keep_directed</span> <span class="o">=</span> <span class="n">keep_directed</span><span class="p">,</span>
            <span class="n">min_refs_undirected</span> <span class="o">=</span> <span class="n">min_refs_undirected</span><span class="p">,</span>
            <span class="n">old_omnipath_resources</span> <span class="o">=</span> <span class="n">old_omnipath_resources</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">make_df</span><span class="p">:</span>

            <span class="bp">cls</span><span class="o">.</span><span class="n">make_df</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">new</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">dorothea_resources</span><span class="p">(</span><span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">expand_levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="n">expand_levels</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">expand_levels</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expand_levels</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dorothea_expand_levels&#39;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">dorothea</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">network_resources</span><span class="o">.</span><span class="n">transcription_dorothea</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">levels</span><span class="p">:</span>

            <span class="n">dorothea</span><span class="p">[</span><span class="s1">&#39;dorothea&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">networkinput</span><span class="o">.</span><span class="n">input_args</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">levels</span>

        <span class="n">dorothea</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">network_resources</span><span class="o">.</span><span class="n">dorothea_expand_levels</span><span class="p">(</span><span class="n">dorothea</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">expand_levels</span> <span class="k">else</span>
            <span class="n">dorothea</span>
        <span class="p">)</span>

        <span class="n">dorothea</span> <span class="o">=</span> <span class="n">dorothea</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;dorothea&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dorothea</span>


    <span class="k">def</span> <span class="nf">load_dorothea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">expand_levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">dorothea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dorothea_resources</span><span class="p">(</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span>
            <span class="n">expand_levels</span> <span class="o">=</span> <span class="n">expand_levels</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dorothea</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="Network.dorothea"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.dorothea">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">dorothea</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new ``Network`` object with loading the transcriptional</span>
<span class="sd">        regulation network from DoRothEA.</span>

<span class="sd">        :arg NontType,set levels:</span>
<span class="sd">            The confidence levels to include.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">make_df</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;make_df&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">load_dorothea</span><span class="p">(</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span> <span class="n">make_df</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span></div>


    <span class="k">def</span> <span class="nf">load_collectri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">network_resources</span><span class="o">.</span><span class="n">collectri</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="Network.collectri"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.collectri">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">collectri</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new ``Network`` object with loading the transcriptional</span>
<span class="sd">        regulation network from CollecTRI.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">make_df</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;make_df&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">load_collectri</span><span class="p">(</span><span class="n">make_df</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span></div>


    <span class="k">def</span> <span class="nf">load_transcription</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">collectri</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">dorothea</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">original_resources</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">dorothea_levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">reread</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">redownload</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>

        <span class="n">make_df</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;make_df&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">collectri</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load_collectri</span><span class="p">(</span>
                <span class="n">reread</span> <span class="o">=</span> <span class="n">reread</span><span class="p">,</span>
                <span class="n">redownload</span> <span class="o">=</span> <span class="n">redownload</span><span class="p">,</span>
                <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">dorothea</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load_dorothea</span><span class="p">(</span>
                <span class="n">levels</span> <span class="o">=</span> <span class="n">dorothea_levels</span><span class="p">,</span>
                <span class="n">reread</span> <span class="o">=</span> <span class="n">reread</span><span class="p">,</span>
                <span class="n">redownload</span> <span class="o">=</span> <span class="n">redownload</span><span class="p">,</span>
                <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">original_resources</span><span class="p">:</span>

            <span class="n">transcription</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">original_resources</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original_resources</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span>
                <span class="n">network_resources</span><span class="o">.</span><span class="n">transcription_onebyone</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;tf_target&#39;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                <span class="n">resources</span> <span class="o">=</span> <span class="n">transcription</span><span class="p">,</span>
                <span class="n">reread</span> <span class="o">=</span> <span class="n">reread</span><span class="p">,</span>
                <span class="n">redownload</span> <span class="o">=</span> <span class="n">redownload</span><span class="p">,</span>
                <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">,</span>
                <span class="n">allow_loops</span> <span class="o">=</span> <span class="n">allow_loops</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">make_df</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">make_df</span><span class="p">()</span>


<div class="viewcode-block" id="Network.transcription"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.transcription">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">transcription</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">dorothea</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">original_resources</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">dorothea_levels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">reread</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">redownload</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">make_df</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">,</span>
            <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new ``Network`` object with loading a transcriptional</span>
<span class="sd">        regulation network from all databases by default.</span>

<span class="sd">        Args</span>
<span class="sd">            kwargs:</span>
<span class="sd">                Passed to ``Network.__init__``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">load_args</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">load_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">)</span>
        <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">load_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ncbi_tax_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">load_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">)</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">load_transcription</span><span class="p">(</span><span class="o">**</span><span class="n">load_args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span></div>


    <span class="k">def</span> <span class="nf">load_mirna_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="s1">&#39;resources&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">network_resources</span><span class="o">.</span><span class="n">mirna_target</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;mirnatarget&#39;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="Network.mirna_target"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.mirna_target">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">mirna_target</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">make_df</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">reread</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">redownload</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="mi">9606</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new ``Network`` object with loading a miRNA-mRNA</span>
<span class="sd">        regulation network from all databases by default.</span>

<span class="sd">        Args</span>
<span class="sd">            kwargs:</span>
<span class="sd">                Passed to ``Network.__init__``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">ncbi_tax_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">load_mirna_target</span><span class="p">(</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">,</span>
            <span class="n">make_df</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">,</span>
            <span class="n">reread</span> <span class="o">=</span> <span class="n">reread</span><span class="p">,</span>
            <span class="n">redownload</span> <span class="o">=</span> <span class="n">redownload</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span></div>

    <span class="c1">#</span>
    <span class="c1"># Methods for querying partners by node</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="Network.partners"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.partners">[docs]</a>    <span class="k">def</span> <span class="nf">partners</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">entity</span><span class="p">,</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">,</span>
            <span class="n">direction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">effect</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">resources</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">interaction_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">via</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">references</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">return_interactions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :arg str,Entity,list,set,tuple,EntityList entity:</span>
<span class="sd">            An identifier or label of a molecular entity or an</span>
<span class="sd">            :py:class:`Entity` object. Alternatively an iterator with the</span>
<span class="sd">            elements of any of the types valid for a single entity argument,</span>
<span class="sd">            e.g. a list of gene symbols.</span>
<span class="sd">        :arg str mode:</span>
<span class="sd">            Mode of counting the interactions: `IN`, `OUT` or `ALL` , whether</span>
<span class="sd">            to consider incoming, outgoing or all edges, respectively,</span>
<span class="sd">            respective to the `node defined in `entity``.</span>

<span class="sd">        :returns:</span>
<span class="sd">            :py:class:`EntityList` object containing the partners having</span>
<span class="sd">            interactions to the queried node(s) matching all the criteria.</span>
<span class="sd">            If ``entity`` doesn&#39;t present in the network the returned</span>
<span class="sd">            ``EntityList`` will be empty just like if no interaction matches</span>
<span class="sd">            the criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">common</span><span class="o">.</span><span class="n">is_str</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s1">&#39;identifier&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span>
        <span class="p">):</span>

            <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;entity&#39;</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;return_interactions&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">EntityList</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">partners</span><span class="p">(</span><span class="n">_entity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_entity</span> <span class="ow">in</span> <span class="n">entity</span>
                <span class="p">)))</span>
            <span class="p">)</span>

        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="c1"># we need to swap it to make it work relative to the queried entity</span>
        <span class="n">_mode</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;IN&#39;</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;OUT&#39;</span> <span class="k">else</span>
            <span class="s1">&#39;OUT&#39;</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;IN&#39;</span> <span class="k">else</span>
            <span class="s1">&#39;ALL&#39;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">entity_mod</span><span class="o">.</span><span class="n">EntityList</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">partner</span>
                    <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span><span class="o">.</span><span class="n">get_degrees</span><span class="p">(</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="n">_mode</span><span class="p">,</span>
                        <span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="p">,</span>
                        <span class="n">effect</span> <span class="o">=</span> <span class="n">effect</span><span class="p">,</span>
                        <span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span><span class="p">,</span>
                        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">interaction_type</span><span class="p">,</span>
                        <span class="n">data_model</span> <span class="o">=</span> <span class="n">data_model</span><span class="p">,</span>
                        <span class="n">via</span> <span class="o">=</span> <span class="n">via</span><span class="p">,</span>
                        <span class="n">references</span> <span class="o">=</span> <span class="n">references</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">partner</span> <span class="o">!=</span> <span class="n">entity</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span><span class="o">.</span><span class="n">is_loop</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_by_nodes</span> <span class="k">else</span>
                <span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Network.count_partners"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.count_partners">[docs]</a>    <span class="k">def</span> <span class="nf">count_partners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the count of the interacting partners for one or more</span>
<span class="sd">        entities according to the specified criteria.</span>
<span class="sd">        Please refer to the docs of the ``partners`` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partners</span><span class="p">(</span><span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_generate_partners_methods</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_create_partners_method</span><span class="p">(</span><span class="n">method_args</span><span class="p">):</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">method_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;count_partners&#39;</span> <span class="k">if</span> <span class="n">count</span> <span class="k">else</span> <span class="s1">&#39;partners&#39;</span>

            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">method_args</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">_partners_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">method_args</span><span class="p">)</span>

                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">_partners_method</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="vm">__doc__</span>

            <span class="k">return</span> <span class="n">_partners_method</span>

        <span class="k">for</span> <span class="n">name_parts</span><span class="p">,</span> <span class="n">arg_parts</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">param</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span><span class="n">iteritems</span><span class="p">(</span><span class="n">variety</span><span class="p">)</span> <span class="k">for</span> <span class="n">variety</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_partners_methods</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">):</span>

            <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>

                <span class="n">method_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                        <span class="o">*</span><span class="p">(</span><span class="n">iteritems</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">arg_parts</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">method_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span>
                <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;count_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">method_name</span> <span class="k">if</span> <span class="n">count</span> <span class="k">else</span> <span class="n">method_name</span>
                <span class="p">)</span>
                <span class="n">method_args</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">_create_partners_method</span><span class="p">(</span><span class="n">method_args</span><span class="p">)</span>
                <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">method_name</span>

                <span class="nb">setattr</span><span class="p">(</span>
                    <span class="bp">cls</span><span class="p">,</span>
                    <span class="n">method_name</span><span class="p">,</span>
                    <span class="n">method</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Methods for selecting paths and motives in the network</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="Network.find_paths"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.find_paths">[docs]</a>    <span class="k">def</span> <span class="nf">find_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">start</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">str</span> <span class="o">|</span> <span class="n">entity</span><span class="o">.</span><span class="n">Entity</span> <span class="o">|</span> <span class="n">entity</span><span class="o">.</span><span class="n">EntityList</span> <span class="o">|</span>
                <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">entity</span><span class="o">.</span><span class="n">Entity</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">end</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">str</span> <span class="o">|</span> <span class="n">entity</span><span class="o">.</span><span class="n">Entity</span> <span class="o">|</span> <span class="n">entity</span><span class="o">.</span><span class="n">EntityList</span> <span class="o">|</span>
                <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">entity</span><span class="o">.</span><span class="n">Entity</span><span class="p">]</span> <span class="o">|</span>
                <span class="kc">None</span>
            <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">loops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;OUT&#39;</span><span class="p">,</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OUT&#39;</span><span class="p">,</span>
            <span class="n">maxlen</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">minlen</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">direction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">effect</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">resources</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">interaction_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">via</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">references</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">silent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find paths or motifs in a network.</span>

<span class="sd">        Finds all paths up to length ``maxlen`` between groups of nodes.</span>
<span class="sd">        In addition is able to search for motifs or select the nodes of a</span>
<span class="sd">        subnetwork around certain nodes.</span>

<span class="sd">        Args</span>
<span class="sd">            start:</span>
<span class="sd">                Starting node(s) of the paths.</span>
<span class="sd">            end:</span>
<span class="sd">                Target node(s) of the paths. If ``None`` any target node will</span>
<span class="sd">                be accepted and all paths from the starting nodes with length</span>
<span class="sd">                ``maxlen`` will be returned.</span>
<span class="sd">            loops:</span>
<span class="sd">                Search for loops, i.e. the start and end nodes of each path</span>
<span class="sd">                should be the same.</span>
<span class="sd">            mode:</span>
<span class="sd">                Direction of the paths. ``&#39;OUT&#39;`` means from ``start`` to ``end``,</span>
<span class="sd">                ``&#39;IN&#39;`` the opposite direction while ``&#39;ALL&#39;`` both directions.</span>
<span class="sd">            maxlen:</span>
<span class="sd">                Maximum length of paths in steps, i.e. if maxlen = 3, then</span>
<span class="sd">                the longest path may consist of 3 edges and 4 nodes.</span>
<span class="sd">            minlen:</span>
<span class="sd">                Minimum length of the path.</span>
<span class="sd">            silent:</span>
<span class="sd">                Indicate progress by showing a progress bar.</span>

<span class="sd">        Details</span>
<span class="sd">            The arguments: ``direction``, ``effect``, ``resources``,</span>
<span class="sd">            ``interaction_type``, ``data_model``, ``via`` and ``references``</span>
<span class="sd">            will be passed to the ``partners`` method of this object and from</span>
<span class="sd">            there to the relevant methods of the ``Interaction`` and</span>
<span class="sd">            ``Evidence`` objects. By these arguments it is possible to filter</span>
<span class="sd">            the interactions in the paths according to custom criteria. If any</span>
<span class="sd">            of these arguments is a ``tuple`` or ``list``, its first value will</span>
<span class="sd">            be used to match the first interaction in the path, the second for</span>
<span class="sd">            the second one and so on. If the list or tuple is shorter then</span>
<span class="sd">            ``maxlen``, its last element will be used for all interactions.</span>
<span class="sd">            If it&#39;s longer than ``maxlen``, the remaining elements will be</span>
<span class="sd">            discarded. This way the method is able to search for custom</span>
<span class="sd">            motives. For example, let&#39;s say you want to find the motives</span>
<span class="sd">            where the estrogen receptor transcription factor *ESR1*</span>
<span class="sd">            transcriptionally regulates a gene encoding a protein which</span>
<span class="sd">            then has some effect post-translationally on *ESR1*:</span>

<span class="sd">        Examples</span>

<span class="sd">            n.find_paths(</span>
<span class="sd">                &#39;ESR1&#39;,</span>
<span class="sd">                loops = True,</span>
<span class="sd">                minlen = 2,</span>
<span class="sd">                interaction_type = (&#39;transcriptional&#39;, &#39;post_translational&#39;),</span>
<span class="sd">            )</span>

<span class="sd">            # Or if you are interested only in the -/+ feedback loops i.e.</span>
<span class="sd">            # *ESR1 --(-)--&gt; X --(+)--&gt; ESR1*:</span>

<span class="sd">            n.find_paths(</span>
<span class="sd">                &#39;ESR1&#39;,</span>
<span class="sd">                loops = True,</span>
<span class="sd">                minlen = 2,</span>
<span class="sd">                interaction_type = (&#39;transcriptional&#39;, &#39;post_translational&#39;),</span>
<span class="sd">                effect = (&#39;negative&#39;, &#39;positive&#39;),</span>
<span class="sd">            )</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">list_of_entities</span><span class="p">(</span><span class="n">entities</span><span class="p">):</span>

            <span class="n">entities</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">entities</span><span class="p">,)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">entities</span><span class="p">,</span>
                        <span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">basestring</span><span class="p">,</span> <span class="n">entity_mod</span><span class="o">.</span><span class="n">Entity</span><span class="p">)</span>
                    <span class="p">)</span> <span class="k">else</span>
                <span class="n">entities</span>
            <span class="p">)</span>

            <span class="n">entities</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">(</span><span class="n">en</span><span class="p">)</span> <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">entities</span>


        <span class="k">def</span> <span class="nf">interaction_arg</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="k">else</span>
                <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
            <span class="p">)</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],)</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="n">maxlen</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">value</span>


        <span class="k">def</span> <span class="nf">find_all_paths_aux</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">minlen</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="p">(</span>
                    <span class="n">start</span> <span class="o">==</span> <span class="n">end</span> <span class="ow">or</span>
                    <span class="p">(</span>
                        <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                        <span class="ow">not</span> <span class="n">loops</span> <span class="ow">and</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">maxlen</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span>
                        <span class="n">loops</span> <span class="ow">and</span>
                        <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">):</span>

                <span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>

            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">maxlen</span><span class="p">:</span>

                <span class="n">next_steps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">partners</span><span class="p">(</span>
                        <span class="n">entity</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">interaction_args</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">next_steps</span> <span class="o">=</span> <span class="n">next_steps</span> <span class="k">if</span> <span class="n">loops</span> <span class="k">else</span> <span class="n">next_steps</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">next_steps</span><span class="p">:</span>

                    <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">find_all_paths_aux</span><span class="p">(</span>
                            <span class="n">node</span><span class="p">,</span>
                            <span class="n">end</span><span class="p">,</span>
                            <span class="n">path</span><span class="p">,</span> <span class="n">maxlen</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="n">paths</span>


        <span class="n">minlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">minlen</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">list_of_entities</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">list_of_entities</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="k">if</span> <span class="n">end</span> <span class="k">else</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>

        <span class="n">interaction_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span>
            <span class="s1">&#39;direction&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">direction</span><span class="p">),</span>
            <span class="s1">&#39;effect&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">effect</span><span class="p">),</span>
            <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">resources</span><span class="p">),</span>
            <span class="s1">&#39;interaction_type&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">),</span>
            <span class="s1">&#39;data_model&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">data_model</span><span class="p">),</span>
            <span class="s1">&#39;via&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">via</span><span class="p">),</span>
            <span class="s1">&#39;references&#39;</span><span class="p">:</span> <span class="n">interaction_arg</span><span class="p">(</span><span class="n">references</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">interaction_args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">interaction_args</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">interaction_args</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxlen</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">all_paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">prg</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">Progress</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">),</span>
                <span class="s1">&#39;Looking up all paths up to length </span><span class="si">%u</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">maxlen</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">start</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">end</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">prg</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

                <span class="n">all_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_all_paths_aux</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="p">[],</span> <span class="n">maxlen</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">prg</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">all_paths</span></div>

    <span class="c1">#</span>
    <span class="c1"># Methods for collecting interaction attributes across the network</span>
    <span class="c1">#</span>

    <span class="k">def</span> <span class="nf">_collect</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">what</span><span class="p">,</span>
            <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">add_total</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects the values of an attribute over all interactions in the</span>
<span class="sd">        network.</span>

<span class="sd">        Args</span>
<span class="sd">            kwargs:</span>
<span class="sd">                Passed to methods of</span>
<span class="sd">                :py:class:`pypath.interaction.Interaction`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">by</span> <span class="k">else</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_by_method_name</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">by</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">interaction_mod</span><span class="o">.</span><span class="n">Interaction</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Collecting attributes: no such method: `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>

                <span class="n">ia_attrs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">by</span><span class="p">:</span>

                    <span class="k">for</span> <span class="n">grp</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">ia_attrs</span><span class="p">):</span>

                        <span class="n">result</span><span class="p">[</span><span class="n">grp</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ia_attrs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">by</span> <span class="ow">and</span> <span class="n">add_total</span><span class="p">:</span>

            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">by</span> <span class="k">else</span> <span class="n">result</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_generate_collect_methods</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_create_collect_method</span><span class="p">(</span><span class="n">what</span><span class="p">):</span>

            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">_collect_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">what</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Collecting `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">what</span><span class="p">)</span>

                <span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="p">(</span>
                    <span class="n">by</span> <span class="o">=</span> <span class="s1">&#39;interaction_type_and_data_model_and_resource&#39;</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">NetworkEntityCollection</span><span class="p">(</span>
                        <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span><span class="p">,</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">what</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">_collect_method</span>


        <span class="k">for</span> <span class="n">_get</span> <span class="ow">in</span> <span class="n">interaction_mod</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">_get_methods</span><span class="p">:</span>

            <span class="n">method</span> <span class="o">=</span> <span class="n">_create_collect_method</span><span class="p">(</span><span class="n">_get</span><span class="p">)</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="s1">&#39;collect_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">_get</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;Builds a comprehensive collection of `</span><span class="si">%s</span><span class="s1">` entities &#39;</span>
                <span class="s1">&#39;across the network, counts unique and shared objects &#39;</span>
                <span class="s1">&#39;by resource, data model and interaction types.&#39;</span> <span class="o">%</span> <span class="n">_get</span>
            <span class="p">)</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="n">interaction_mod</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">_get_method_signature</span>

            <span class="k">if</span> <span class="s1">&#39;degree&#39;</span> <span class="ow">in</span> <span class="n">_get</span><span class="p">:</span>

                <span class="n">signature</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mode&#39;</span><span class="p">,)]</span> <span class="o">+</span> <span class="n">signature</span>

            <span class="bp">cls</span><span class="o">.</span><span class="n">_add_method</span><span class="p">(</span>
                <span class="n">method_name</span><span class="p">,</span>
                <span class="n">method</span><span class="p">,</span>
                <span class="n">signature</span> <span class="o">=</span> <span class="n">signature</span><span class="p">,</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span><span class="p">,</span>
            <span class="p">)</span>


    <span class="k">def</span> <span class="nf">update_summaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collect_args</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>


        <span class="k">def</span> <span class="nf">get_labels</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">segments</span><span class="p">):</span>

            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">%s%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span>
                        <span class="s1">&#39;_&#39;</span> <span class="k">if</span> <span class="n">seg</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">seg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;_pct&#39;</span> <span class="k">if</span> <span class="n">pct</span> <span class="k">else</span> <span class="s1">&#39;_n&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;</span><span class="si">%s%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="k">if</span> <span class="n">seg</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">seg</span><span class="p">,</span> <span class="n">pct</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segments</span>
                <span class="k">for</span> <span class="n">pct</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; [%]&#39;</span><span class="p">)</span>
            <span class="p">)</span>


        <span class="k">def</span> <span class="nf">add_resource_segments</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">coll</span><span class="p">):</span>

            <span class="n">get</span> <span class="o">=</span> <span class="n">coll</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="fm">__getattribute__</span>

            <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_collection&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_shared_within_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_unique_within_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_shared_within_interaction_type&#39;</span> <span class="o">%</span> <span class="n">n_pct</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_unique_within_interaction_type&#39;</span> <span class="o">%</span> <span class="n">n_pct</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">n_pct</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;pct&#39;</span><span class="p">)</span>
            <span class="p">))))</span>

            <span class="n">labels</span> <span class="o">=</span> <span class="n">get_labels</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>

            <span class="n">rec</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)))</span>

            <span class="k">return</span> <span class="n">rec</span>


        <span class="k">def</span> <span class="nf">add_dmodel_segments</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">itype</span><span class="p">,</span> <span class="n">dmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">coll</span><span class="p">):</span>

            <span class="n">it_dm_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">itype</span><span class="p">,</span> <span class="n">dmodel</span><span class="p">)</span>
            <span class="n">total_key</span> <span class="o">=</span> <span class="n">it_dm_key</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,)</span>

            <span class="n">get</span> <span class="o">=</span> <span class="n">coll</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="fm">__getattribute__</span>

            <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_by_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">it_dm_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_shared_within_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">total_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_unique_within_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">total_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_shared_by_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">it_dm_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_unique_by_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">it_dm_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">n_pct</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;pct&#39;</span><span class="p">)</span>
            <span class="p">))))</span>

            <span class="n">labels</span> <span class="o">=</span> <span class="n">get_labels</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>

            <span class="n">rec</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)))</span>

            <span class="k">return</span> <span class="n">rec</span>


        <span class="k">def</span> <span class="nf">add_itype_segments</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">itype</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">coll</span><span class="p">):</span>

            <span class="n">get</span> <span class="o">=</span> <span class="n">coll</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="fm">__getattribute__</span>
            <span class="n">total_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">itype</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;Total&#39;</span><span class="p">)</span>

            <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_by_interaction_type&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itype</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_shared_within_interaction_type&#39;</span> <span class="o">%</span> <span class="n">n_pct</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">total_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_unique_within_interaction_type&#39;</span> <span class="o">%</span> <span class="n">n_pct</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">total_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_shared_by_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">total_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">get</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_unique_by_data_model&#39;</span> <span class="o">%</span> <span class="n">n_pct</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">total_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">n_pct</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;pct&#39;</span><span class="p">)</span>
            <span class="p">))))</span>

            <span class="n">labels</span> <span class="o">=</span> <span class="n">get_labels</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>

            <span class="n">rec</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)))</span>

            <span class="k">return</span> <span class="n">rec</span>


        <span class="n">collect_args</span> <span class="o">=</span> <span class="n">collect_args</span> <span class="ow">or</span> <span class="p">{</span><span class="s1">&#39;via&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>


        <span class="n">required</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="s1">&#39;Entities&#39;</span><span class="p">,</span>
            <span class="n">proteins</span> <span class="o">=</span> <span class="s1">&#39;Proteins&#39;</span><span class="p">,</span>
            <span class="n">mirnas</span> <span class="o">=</span> <span class="s1">&#39;miRNAs&#39;</span><span class="p">,</span>
            <span class="n">interactions_0</span> <span class="o">=</span> <span class="s1">&#39;Edges&#39;</span><span class="p">,</span>
            <span class="n">references</span> <span class="o">=</span> <span class="s1">&#39;References&#39;</span><span class="p">,</span>
            <span class="n">curation_effort</span> <span class="o">=</span> <span class="s1">&#39;Curation effort&#39;</span><span class="p">,</span>
            <span class="n">interactions_non_directed_0</span> <span class="o">=</span> <span class="s1">&#39;Undirected interactions&#39;</span><span class="p">,</span>
            <span class="n">interactions_directed</span> <span class="o">=</span> <span class="s1">&#39;Directed interactions&#39;</span><span class="p">,</span>
            <span class="n">interactions_positive</span> <span class="o">=</span> <span class="s1">&#39;Stimulatory interactions&#39;</span><span class="p">,</span>
            <span class="n">interactions_negative</span> <span class="o">=</span> <span class="s1">&#39;Inhibitory interactions&#39;</span><span class="p">,</span>
            <span class="n">interactions_mutual</span> <span class="o">=</span> <span class="s1">&#39;Mutual interactions&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">segments</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;shared within database category&#39;</span><span class="p">,</span>
            <span class="s1">&#39;unique within database category&#39;</span><span class="p">,</span>
            <span class="s1">&#39;shared within interaction type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;unique within interaction type&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">coll</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Updating summaries.&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">required</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">coll</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;collect_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)(</span>
                <span class="o">**</span><span class="n">collect_args</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">itype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interaction_types</span><span class="p">():</span>

            <span class="k">for</span> <span class="n">dmodel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_models</span><span class="p">(</span><span class="n">interaction_type</span> <span class="o">=</span> <span class="n">itype</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span>
                        <span class="n">interaction_type</span> <span class="o">=</span> <span class="n">itype</span><span class="p">,</span>
                        <span class="n">data_model</span> <span class="o">=</span> <span class="n">dmodel</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">collect_args</span>
                    <span class="p">),</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="p">):</span>

                    <span class="c1"># compiling a record for each resource</span>
                    <span class="c1"># within the data model</span>

                    <span class="n">rec</span> <span class="o">=</span> <span class="p">[((</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="s1">&#39;Resource&#39;</span><span class="p">),</span> <span class="n">res</span><span class="p">)]</span>

                    <span class="n">_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">itype</span><span class="p">,</span> <span class="n">dmodel</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">required</span><span class="p">):</span>

                        <span class="n">rec</span> <span class="o">=</span> <span class="n">add_resource_segments</span><span class="p">(</span>
                            <span class="n">rec</span><span class="p">,</span> <span class="n">_res</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">coll</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

                <span class="c1"># compiling a summary record for the data model</span>

                <span class="n">rec</span> <span class="o">=</span> <span class="p">[(</span>
                    <span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="s1">&#39;Resource&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> total&#39;</span> <span class="o">%</span> <span class="n">dmodel</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                <span class="p">)]</span>

                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">required</span><span class="p">):</span>

                    <span class="n">rec</span> <span class="o">=</span> <span class="n">add_dmodel_segments</span><span class="p">(</span>
                        <span class="n">rec</span><span class="p">,</span> <span class="n">itype</span><span class="p">,</span> <span class="n">dmodel</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">coll</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

            <span class="c1"># compiling a summary record for the interaction type</span>

            <span class="n">rec</span> <span class="o">=</span> <span class="p">[(</span>
                <span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="s1">&#39;Resource&#39;</span><span class="p">),</span>
                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> total&#39;</span> <span class="o">%</span> <span class="n">itype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="p">)]</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">required</span><span class="p">):</span>

                <span class="n">rec</span> <span class="o">=</span> <span class="n">add_itype_segments</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">itype</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">coll</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

        <span class="c1"># maybe we could compile a summary record for the entire network</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s1">&#39;Finished updating summaries.&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Network.summaries_tab"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.summaries_tab">[docs]</a>    <span class="k">def</span> <span class="nf">summaries_tab</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">return_table</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">label_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a table from resource vs. entity counts and optionally</span>
<span class="sd">        writes it to ``outfile`` and returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tab</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">label_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summaries</span><span class="p">:</span>

            <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rec</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

        <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tab</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">return_table</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">tab</span></div>


    <span class="k">def</span> <span class="nf">homology_translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxon</span><span class="p">,</span> <span class="n">exclude</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Translating network by homology from organism `</span><span class="si">%u</span><span class="s1">` to `</span><span class="si">%u</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ncbi_tax_id</span><span class="p">,</span>
                <span class="n">taxon</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">new</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="n">ncbi_tax_id</span> <span class="o">=</span> <span class="n">taxon</span><span class="p">)</span>

        <span class="n">n_ia_translated</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">entities_translated</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>

            <span class="n">ia_translated</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">new_ia</span> <span class="ow">in</span> <span class="n">ia</span><span class="o">.</span><span class="n">homology_translate</span><span class="p">(</span>
                <span class="n">taxon</span> <span class="o">=</span> <span class="n">taxon</span><span class="p">,</span>
                <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span><span class="p">,</span>
            <span class="p">):</span>

                <span class="n">new</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="n">new_ia</span><span class="p">)</span>
                <span class="n">ia_translated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">entities_translated</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ia</span><span class="o">.</span><span class="n">get_entities</span><span class="p">())</span>

            <span class="n">n_ia_translated</span> <span class="o">+=</span> <span class="n">ia_translated</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span>
            <span class="s1">&#39;Homology translation ready. &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> out of </span><span class="si">%u</span><span class="s1"> interactions (</span><span class="si">%.02f%%</span><span class="s1">), &#39;</span>
            <span class="s1">&#39;</span><span class="si">%u</span><span class="s1"> out of </span><span class="si">%u</span><span class="s1"> entities (</span><span class="si">%.02f%%</span><span class="s1">) &#39;</span>
            <span class="s1">&#39;have been translated.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">n_ia_translated</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                <span class="n">n_ia_translated</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">entities_translated</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">entities_translated</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_by_method_name</span><span class="p">(</span><span class="n">get</span><span class="p">,</span> <span class="n">by</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s1">&#39;get_&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">by</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">get</span><span class="p">,</span>
                    <span class="s1">&#39;_by_&#39;</span> <span class="k">if</span> <span class="n">by</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">by</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_iter_get_by_methods</span><span class="p">():</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                <span class="n">interaction_mod</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">_get_methods</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;entities&#39;</span><span class="p">},</span>
                <span class="n">interaction_mod</span><span class="o">.</span><span class="n">Interaction</span><span class="o">.</span><span class="n">_by_methods</span> <span class="o">+</span> <span class="p">(</span><span class="kc">None</span><span class="p">,),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_generate_get_methods</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_create_get_method</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">by</span><span class="p">):</span>

            <span class="n">wrap_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">by</span><span class="p">)</span>

            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">wrap_args</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">_get_by_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

                <span class="n">what</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">wrap_args</span>

                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">what</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;by&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">by</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_get_by_method</span>


        <span class="k">for</span> <span class="n">_get</span><span class="p">,</span> <span class="n">_by</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_iter_get_by_methods</span><span class="p">():</span>

            <span class="n">method_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_by_method_name</span><span class="p">(</span><span class="n">_get</span><span class="p">,</span> <span class="n">_by</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">cls</span><span class="p">,</span>
                <span class="n">method_name</span><span class="p">,</span>
                <span class="n">_create_get_method</span><span class="p">(</span><span class="n">what</span> <span class="o">=</span> <span class="n">_get</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">_by</span><span class="p">),</span>
            <span class="p">)</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_generate_count_methods</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_create_count_method</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">by</span><span class="p">):</span>

            <span class="n">method_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_by_method_name</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">by</span><span class="p">)</span>

            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">_count_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

                <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">collection</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> <span class="k">else</span>
                    <span class="n">common</span><span class="o">.</span><span class="n">dict_counts</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">_count_method</span>


        <span class="k">for</span> <span class="n">_get</span><span class="p">,</span> <span class="n">_by</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_iter_get_by_methods</span><span class="p">():</span>

            <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;count_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_get_by_method_name</span><span class="p">(</span><span class="n">_get</span><span class="p">,</span> <span class="n">_by</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;get_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">cls</span><span class="p">,</span>
                <span class="n">method_name</span><span class="p">,</span>
                <span class="n">_create_count_method</span><span class="p">(</span><span class="n">what</span> <span class="o">=</span> <span class="n">_get</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">_by</span><span class="p">)</span>
            <span class="p">)</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_add_method</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">signature</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">doc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="n">common</span><span class="o">.</span><span class="n">_add_method</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">method_name</span><span class="p">,</span>
            <span class="n">method</span><span class="p">,</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="n">signature</span><span class="p">,</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span><span class="p">,</span>
        <span class="p">)</span>


    <span class="k">def</span> <span class="nf">_allow_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_loops</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrates settings for the `allow_loops` parameter from the</span>
<span class="sd">        method, instance and module level settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">default</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network_allow_loops&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="c1"># from the arguments of the actual `load` call</span>
            <span class="n">allow_loops</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">allow_loops</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span>
            <span class="c1"># from the current instance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_loops</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_loops</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span>
            <span class="c1"># resource specific settings</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">networkinput</span><span class="o">.</span><span class="n">allow_loops</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">hasattr</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;networkinput&#39;</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">networkinput</span><span class="o">.</span><span class="n">allow_loops</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
                <span class="p">)</span> <span class="k">else</span>
            <span class="c1"># interaction type specific settings from the module level</span>
            <span class="n">resource</span><span class="o">.</span><span class="n">networkinput</span><span class="o">.</span><span class="n">interaction_type</span> <span class="ow">in</span> <span class="n">default</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">list_like</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="nb">hasattr</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;networkinput&#39;</span><span class="p">)</span>
                <span class="p">)</span> <span class="k">else</span>
            <span class="c1"># general settings from the module level</span>
            <span class="nb">bool</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="p">)</span>


    <span class="k">def</span> <span class="nf">count_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ia</span><span class="o">.</span><span class="n">is_loop</span><span class="p">()</span> <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="Network.direction_consistency"><a class="viewcode-back" href="../../../api/pypath.core.network.Network.html#pypath.core.network.Network.direction_consistency">[docs]</a>    <span class="k">def</span> <span class="nf">direction_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects statistics about the consistency of interaction</span>
<span class="sd">        directions between resources.</span>
<span class="sd">        * total_directed: number of directed edges</span>
<span class="sd">        * shared_directed: number of directed edges in overlap with other</span>
<span class="sd">          resources</span>
<span class="sd">        * consistent_edges: number of edges consistent with other resources</span>
<span class="sd">        * inconsistent_edges: number of edges inconsistent with other</span>
<span class="sd">          resources</span>
<span class="sd">        * total_consistency: sum of consistencies (for all edges and all</span>
<span class="sd">          resources)</span>
<span class="sd">        * total_inconsistency: sum of inconsistencies (for all edges and all</span>
<span class="sd">          resources)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">dd_matrix</span><span class="p">(</span><span class="n">dd</span><span class="p">):</span>

            <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">],</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">names</span><span class="p">,</span>
            <span class="p">)</span>


        <span class="n">DirectionConsistency</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
            <span class="s1">&#39;DirectionConsistency&#39;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s1">&#39;total_directed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;shared_directed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;consistent_edges&#39;</span><span class="p">,</span>
                <span class="s1">&#39;inconsistent_edges&#39;</span><span class="p">,</span>
                <span class="s1">&#39;total_consistency&#39;</span><span class="p">,</span>
                <span class="s1">&#39;total_inconsistency&#39;</span><span class="p">,</span>
                <span class="s1">&#39;total_signed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;shared_signed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;consistent_signed_edges&#39;</span><span class="p">,</span>
                <span class="s1">&#39;inconsistent_signed_edges&#39;</span><span class="p">,</span>
                <span class="s1">&#39;total_sign_consistency&#39;</span><span class="p">,</span>
                <span class="s1">&#39;total_sign_inconsistency&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">resources</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span><span class="n">via</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">consistencies</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">resource1</span><span class="p">,</span>
                <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">resource2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">resource2</span> <span class="ow">in</span> <span class="n">resources</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">resource1</span> <span class="ow">in</span> <span class="n">resources</span>
        <span class="p">)</span>
        <span class="n">inconsistencies</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">consistencies</span><span class="p">)</span>
        <span class="n">sign_consistencies</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">consistencies</span><span class="p">)</span>
        <span class="n">sign_inconsistencies</span> <span class="o">=</span> <span class="n">copy_mod</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">consistencies</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>

            <span class="n">total_directed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">shared_directed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">consistent_edges</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">inconsistent_edges</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_consistency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_inconsistency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_signed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">shared_signed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">consistent_signed_edges</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">inconsistent_signed_edges</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_sign_consistency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_sign_inconsistency</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">ia</span><span class="o">.</span><span class="n">is_directed</span><span class="p">():</span>

                    <span class="k">continue</span>

                <span class="n">res_a_b</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">a_b</span><span class="p">]</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span><span class="n">via</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">res_b_a</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">b_a</span><span class="p">]</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span><span class="n">via</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">res_a_b_pos</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">a_b</span><span class="p">]</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span>
                    <span class="n">via</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">res_a_b_neg</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">a_b</span><span class="p">]</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span>
                    <span class="n">via</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">res_b_a_pos</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">positive</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">b_a</span><span class="p">]</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span>
                    <span class="n">via</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">res_b_a_neg</span> <span class="o">=</span> <span class="n">ia</span><span class="o">.</span><span class="n">negative</span><span class="p">[</span><span class="n">ia</span><span class="o">.</span><span class="n">b_a</span><span class="p">]</span><span class="o">.</span><span class="n">get_resource_names</span><span class="p">(</span>
                    <span class="n">via</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b</span> <span class="ow">or</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a</span><span class="p">:</span>

                    <span class="n">total_directed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_pos</span> <span class="ow">or</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_neg</span><span class="p">:</span>

                    <span class="n">total_signed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_pos</span> <span class="ow">or</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_neg</span><span class="p">:</span>

                    <span class="n">total_signed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b</span> <span class="o">|</span> <span class="n">res_b_a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                    <span class="n">shared_directed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b_pos</span> <span class="o">|</span> <span class="n">res_a_b_neg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                    <span class="n">shared_signed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a_pos</span> <span class="o">|</span> <span class="n">res_b_a_neg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                    <span class="n">shared_signed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">consistent_edges</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_pos</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_neg</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b_neg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">consistent_signed_edges</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_pos</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_neg</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a_neg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">consistent_signed_edges</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b</span> <span class="ow">and</span>
                        <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_b_a</span> <span class="ow">and</span>
                        <span class="n">res_b_a</span>
                    <span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span>
                        <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a</span> <span class="ow">and</span>
                        <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_a_b</span> <span class="ow">and</span>
                        <span class="n">res_a_b</span>
                    <span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">inconsistent_edges</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_pos</span> <span class="ow">and</span>
                        <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_a_b_neg</span> <span class="ow">and</span>
                        <span class="n">res_a_b_neg</span>
                    <span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span>
                        <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_neg</span> <span class="ow">and</span>
                        <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_a_b_pos</span> <span class="ow">and</span>
                        <span class="n">res_a_b_pos</span>
                    <span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">inconsistent_signed_edges</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_pos</span> <span class="ow">and</span>
                        <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_b_a_neg</span> <span class="ow">and</span>
                        <span class="n">res_b_a_neg</span>
                    <span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span>
                        <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_neg</span> <span class="ow">and</span>
                        <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_b_a_pos</span> <span class="ow">and</span>
                        <span class="n">res_b_a_pos</span>
                    <span class="p">)</span>
                <span class="p">):</span>

                    <span class="n">inconsistent_signed_edges</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b</span><span class="p">:</span>

                    <span class="n">total_consistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">total_inconsistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_pos</span><span class="p">:</span>

                    <span class="n">total_sign_consistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b_pos</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_a_b_neg</span><span class="p">:</span>

                    <span class="n">total_sign_consistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b_neg</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_pos</span><span class="p">:</span>

                    <span class="n">total_sign_consistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a_pos</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a_neg</span><span class="p">:</span>

                    <span class="n">total_sign_consistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a_neg</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_a_b_pos</span><span class="p">:</span>

                    <span class="n">total_sign_inconsistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b_pos</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_a_b_neg</span><span class="p">:</span>

                    <span class="n">total_sign_inconsistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_a_b_neg</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_b_a_pos</span><span class="p">:</span>

                    <span class="n">total_sign_inconsistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a_pos</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_b_a_neg</span><span class="p">:</span>

                    <span class="n">total_sign_inconsistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a_neg</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">res_b_a</span><span class="p">:</span>

                    <span class="n">total_consistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">total_inconsistency</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_b_a</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">dir_resources</span> <span class="ow">in</span> <span class="p">(</span><span class="n">res_a_b</span><span class="p">,</span> <span class="n">res_b_a</span><span class="p">):</span>

                    <span class="k">for</span> <span class="n">res_other</span> <span class="ow">in</span> <span class="n">dir_resources</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">dir_resources</span><span class="p">:</span>

                            <span class="n">consistencies</span><span class="p">[</span><span class="n">resource</span><span class="p">][</span><span class="n">res_other</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">inconsistencies</span><span class="p">[</span><span class="n">resource</span><span class="p">][</span><span class="n">res_other</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">sign_resources</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">res_a_b_pos</span><span class="p">,</span>
                    <span class="n">res_a_b_neg</span><span class="p">,</span>
                    <span class="n">res_b_a_pos</span><span class="p">,</span>
                    <span class="n">res_a_b_neg</span><span class="p">,</span>
                <span class="p">):</span>

                    <span class="k">for</span> <span class="n">res_other</span> <span class="ow">in</span> <span class="n">sign_resources</span><span class="p">:</span>

                        <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">sign_resources</span><span class="p">:</span>

                            <span class="n">sign_consistencies</span><span class="p">[</span><span class="n">resource</span><span class="p">][</span><span class="n">res_other</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">sign_inconsistencies</span><span class="p">[</span><span class="n">resource</span><span class="p">][</span><span class="n">res_other</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">summary</span><span class="p">[</span><span class="n">resource</span><span class="p">]</span> <span class="o">=</span> <span class="n">DirectionConsistency</span><span class="p">(</span>
                <span class="n">total_directed</span> <span class="o">=</span> <span class="n">total_directed</span><span class="p">,</span>
                <span class="n">shared_directed</span> <span class="o">=</span> <span class="n">shared_directed</span><span class="p">,</span>
                <span class="n">consistent_edges</span> <span class="o">=</span> <span class="n">consistent_edges</span><span class="p">,</span>
                <span class="n">inconsistent_edges</span> <span class="o">=</span> <span class="n">inconsistent_edges</span><span class="p">,</span>
                <span class="n">total_consistency</span> <span class="o">=</span> <span class="n">total_consistency</span><span class="p">,</span>
                <span class="n">total_inconsistency</span> <span class="o">=</span> <span class="n">total_inconsistency</span><span class="p">,</span>
                <span class="n">total_signed</span> <span class="o">=</span> <span class="n">total_signed</span><span class="p">,</span>
                <span class="n">shared_signed</span> <span class="o">=</span> <span class="n">shared_signed</span><span class="p">,</span>
                <span class="n">consistent_signed_edges</span> <span class="o">=</span> <span class="n">consistent_signed_edges</span><span class="p">,</span>
                <span class="n">inconsistent_signed_edges</span> <span class="o">=</span> <span class="n">inconsistent_signed_edges</span><span class="p">,</span>
                <span class="n">total_sign_consistency</span> <span class="o">=</span> <span class="n">total_sign_consistency</span><span class="p">,</span>
                <span class="n">total_sign_inconsistency</span> <span class="o">=</span> <span class="n">total_sign_inconsistency</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">consistencies</span> <span class="o">=</span> <span class="n">dd_matrix</span><span class="p">(</span><span class="n">consistencies</span><span class="p">)</span>
        <span class="n">inconsistencies</span> <span class="o">=</span> <span class="n">dd_matrix</span><span class="p">(</span><span class="n">inconsistencies</span><span class="p">)</span>
        <span class="n">sign_consistencies</span> <span class="o">=</span> <span class="n">dd_matrix</span><span class="p">(</span><span class="n">sign_consistencies</span><span class="p">)</span>
        <span class="n">sign_inconsistencies</span> <span class="o">=</span> <span class="n">dd_matrix</span><span class="p">(</span><span class="n">sign_inconsistencies</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="n">resource</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">resource</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">],</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">DirectionConsistency</span><span class="o">.</span><span class="n">_fields</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="n">summary</span><span class="p">,</span>
            <span class="s1">&#39;consistencies&#39;</span><span class="p">:</span> <span class="n">consistencies</span><span class="p">,</span>
            <span class="s1">&#39;inconsistencies&#39;</span><span class="p">:</span> <span class="n">inconsistencies</span><span class="p">,</span>
            <span class="s1">&#39;sign_consistencies&#39;</span><span class="p">:</span> <span class="n">sign_consistencies</span><span class="p">,</span>
            <span class="s1">&#39;sign_inconsistencies&#39;</span><span class="p">:</span> <span class="n">sign_inconsistencies</span><span class="p">,</span>
        <span class="p">}</span></div></div>


<span class="n">Network</span><span class="o">.</span><span class="n">_generate_get_methods</span><span class="p">()</span>
<span class="n">Network</span><span class="o">.</span><span class="n">_generate_partners_methods</span><span class="p">()</span>
<span class="n">Network</span><span class="o">.</span><span class="n">_generate_count_methods</span><span class="p">()</span>
<span class="n">Network</span><span class="o">.</span><span class="n">_generate_collect_methods</span><span class="p">()</span>


<div class="viewcode-block" id="init_db"><a class="viewcode-back" href="../../../api/pypath.core.network.init_db.html#pypath.core.network.init_db">[docs]</a><span class="k">def</span> <span class="nf">init_db</span><span class="p">(</span><span class="n">use_omnipath</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="n">method_name</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;load_omnipath&#39;</span>
            <span class="k">if</span> <span class="n">use_omnipath</span> <span class="k">else</span>
        <span class="p">(</span><span class="n">method</span> <span class="ow">or</span> <span class="s1">&#39;load&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">new_network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>
    <span class="n">maybe_network</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_network</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nb">globals</span><span class="p">()[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maybe_network</span> <span class="ow">or</span> <span class="n">new_network</span></div>


<div class="viewcode-block" id="get_db"><a class="viewcode-back" href="../../../api/pypath.core.network.get_db.html#pypath.core.network.get_db">[docs]</a><span class="k">def</span> <span class="nf">get_db</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="s1">&#39;db&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>

        <span class="n">init_db</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">globals</span><span class="p">()[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span></div>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../index.html">Welcome to pypath!</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../webservice.html">Webservice</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../releasehistory.html">Release history</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../reference.html">Reference</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../notebooks/manual.html">The pypath book</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Denes Turei &lt;turei.denes@gmail.com&gt;, Nicolàs Palacio, Sebastian Lobentanzer, Olga Ivanova, Melih Darcan, Erva Ulusoy, Tennur Kilic, Omer Kaan Vural, Ahmet Rifaioglu, Charles Tapley Hoyt.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>